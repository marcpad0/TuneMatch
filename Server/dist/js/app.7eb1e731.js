(function(){"use strict";var e={6455:function(e,t,i){var o=i(5130),s=i(6768);const a={id:"app"},n={class:"nav-links"},r={class:"content"};function l(e,t){const i=(0,s.g2)("router-link"),o=(0,s.g2)("router-view");return(0,s.uX)(),(0,s.CE)("div",a,[(0,s.Lk)("nav",null,[(0,s.Lk)("ul",n,[(0,s.Lk)("li",null,[(0,s.bF)(i,{to:"/register"},{default:(0,s.k6)((()=>t[0]||(t[0]=[(0,s.eW)("Register")]))),_:1})]),(0,s.Lk)("li",null,[(0,s.bF)(i,{to:"/"},{default:(0,s.k6)((()=>t[1]||(t[1]=[(0,s.eW)("Login")]))),_:1})])])]),(0,s.Lk)("main",r,[(0,s.bF)(o)])])}var u=i(1241);const c={},d=(0,u.A)(c,[["render",l]]);var p=d,g=(i(8111),i(3579),i(1387)),h=i.p+"img/spotify-logo.e5c8776a.png",m=i.p+"img/google-logo.963bc2a0.png";const k={class:"login-container"},f={class:"login-card"},L={class:"input-group"},b={class:"input-group"},v={class:"input-group"},y={class:"input-group"},w={class:"input-group"},U={class:"social-logins"},C={class:"spotify-login"},E={class:"google-login"},S={class:"register-link"};function D(e,t,i,a,n,r){const l=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",k,[(0,s.Lk)("div",f,[t[18]||(t[18]=(0,s.Lk)("h2",{class:"title"},"Registrati",-1)),(0,s.Lk)("form",{onSubmit:t[5]||(t[5]=(0,o.D$)(((...e)=>r.registerUser&&r.registerUser(...e)),["prevent"]))},[(0,s.Lk)("div",L,[t[8]||(t[8]=(0,s.Lk)("label",{for:"username"},"Username",-1)),(0,s.bo)((0,s.Lk)("input",{id:"username","onUpdate:modelValue":t[0]||(t[0]=e=>n.username=e),type:"text",placeholder:"Inserisci il tuo username",required:""},null,512),[[o.Jo,n.username]])]),(0,s.Lk)("div",b,[t[9]||(t[9]=(0,s.Lk)("label",{for:"emailSpotify"},"Email Spotify",-1)),(0,s.bo)((0,s.Lk)("input",{id:"emailSpotify","onUpdate:modelValue":t[1]||(t[1]=e=>n.emailSpotify=e),type:"email",placeholder:"Inserisci la tua email di Spotify",required:""},null,512),[[o.Jo,n.emailSpotify]])]),(0,s.Lk)("div",v,[t[10]||(t[10]=(0,s.Lk)("label",{for:"position"},"Posizione",-1)),(0,s.bo)((0,s.Lk)("input",{id:"position","onUpdate:modelValue":t[2]||(t[2]=e=>n.position=e),type:"text",placeholder:"Inserisci la tua posizione",required:""},null,512),[[o.Jo,n.position]])]),(0,s.Lk)("div",y,[t[11]||(t[11]=(0,s.Lk)("label",{for:"dateBorn"},"Data di Nascita",-1)),(0,s.bo)((0,s.Lk)("input",{id:"dateBorn","onUpdate:modelValue":t[3]||(t[3]=e=>n.dateBorn=e),type:"date",required:""},null,512),[[o.Jo,n.dateBorn]])]),(0,s.Lk)("div",w,[t[12]||(t[12]=(0,s.Lk)("label",{for:"password"},"Password",-1)),(0,s.bo)((0,s.Lk)("input",{id:"password","onUpdate:modelValue":t[4]||(t[4]=e=>n.password=e),type:"password",placeholder:"Inserisci la tua password",required:""},null,512),[[o.Jo,n.password]])]),t[13]||(t[13]=(0,s.Lk)("button",{type:"submit",class:"login-button"},"Registrati",-1))],32),(0,s.Lk)("div",U,[(0,s.Lk)("div",C,[(0,s.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>r.loginWithSpotify&&r.loginWithSpotify(...e)),class:"spotify-button"},t[14]||(t[14]=[(0,s.Lk)("img",{src:h,alt:"Spotify Logo"},null,-1),(0,s.eW)(" Accedi con Spotify ")]))]),(0,s.Lk)("div",E,[(0,s.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>r.loginWithGoogle&&r.loginWithGoogle(...e)),class:"google-button"},t[15]||(t[15]=[(0,s.Lk)("img",{src:m,alt:"Google Logo"},null,-1),(0,s.eW)(" Accedi con Google ")]))])]),(0,s.Lk)("p",S,[t[17]||(t[17]=(0,s.eW)(" Hai già un account? ")),(0,s.bF)(l,{to:"/login"},{default:(0,s.k6)((()=>t[16]||(t[16]=[(0,s.eW)("Accedi")]))),_:1})])])])}i(4114);var P=i(4373),A={name:"tofo-item",data(){return{username:"",emailSpotify:"",position:"",password:"",dateBorn:""}},methods:{async registerUser(){try{const e=await P.A.post("/users",{Username:this.username,emailSpotify:this.emailSpotify,Position:this.position,Password:this.password,DateBorn:this.dateBorn});alert(`Utente registrato con successo con ID: ${e.data.message}`),this.$router.push("/")}catch(e){console.error("Errore durante la registrazione:",e),e.response&&409===e.response.status?alert("Registrazione fallita: Nome utente già in uso."):e.response&&e.response.data&&e.response.data.message?alert(`Registrazione fallita: ${e.response.data.message}`):alert("Registrazione fallita. Riprova più tardi.")}},loginWithSpotify(){window.location.href="/auth/spotify"},loginWithTwitch(){window.location.href="/auth/Twitch"},loginWithGoogle(){window.location.href="/auth/google"}}};const M=(0,u.A)(A,[["render",D],["__scopeId","data-v-64580126"]]);var I=M;const _={class:"login-container"},W={class:"login-card"},B={class:"input-group"},X={class:"input-group"},$={class:"spotify-login"},F={class:"google-login"},q={class:"register-link"};function G(e,t,i,a,n,r){const l=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",_,[(0,s.Lk)("div",W,[t[12]||(t[12]=(0,s.Lk)("h2",{class:"title"},"Accedi",-1)),(0,s.Lk)("form",{onSubmit:t[2]||(t[2]=(0,o.D$)(((...e)=>r.loginUser&&r.loginUser(...e)),["prevent"]))},[(0,s.Lk)("div",B,[t[5]||(t[5]=(0,s.Lk)("label",{for:"username"},"Username",-1)),(0,s.bo)((0,s.Lk)("input",{id:"username","onUpdate:modelValue":t[0]||(t[0]=e=>n.username=e),type:"text",placeholder:"Inserisci il tuo username",required:""},null,512),[[o.Jo,n.username]])]),(0,s.Lk)("div",X,[t[6]||(t[6]=(0,s.Lk)("label",{for:"password"},"Password",-1)),(0,s.bo)((0,s.Lk)("input",{id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),type:"password",placeholder:"Inserisci la tua password",required:""},null,512),[[o.Jo,n.password]])]),t[7]||(t[7]=(0,s.Lk)("button",{type:"submit",class:"login-button"},"Login",-1))],32),(0,s.Lk)("div",$,[(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>r.loginWithSpotify&&r.loginWithSpotify(...e)),class:"spotify-button"},t[8]||(t[8]=[(0,s.Lk)("img",{src:h,alt:"Spotify Logo"},null,-1),(0,s.eW)(" Accedi con Spotify ")]))]),(0,s.Lk)("div",F,[(0,s.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.loginWithGoogle&&r.loginWithGoogle(...e)),class:"google-button"},t[9]||(t[9]=[(0,s.Lk)("img",{src:m,alt:"Google Logo"},null,-1),(0,s.eW)(" Accedi con Google ")]))]),(0,s.Lk)("p",q,[t[11]||(t[11]=(0,s.eW)(" Non hai un account? ")),(0,s.bF)(l,{to:"/register"},{default:(0,s.k6)((()=>t[10]||(t[10]=[(0,s.eW)("Registrati")]))),_:1})])])])}var J={name:"todo-item",data(){return{username:"",password:""}},methods:{async loginUser(){try{await P.A.post("/login",{Username:this.username,Password:this.password},{withCredentials:!0});const e=await P.A.get("/auth/me",{withCredentials:!0});e.data&&e.data.isAdmin?this.$router.push("/admin"):this.$router.push("/users")}catch(e){console.error(e),e.response?.data?.message?alert(`Login fallito: ${e.response.data.message}`):alert(`Login fallito: ${e.message}`)}},loginWithSpotify(){window.location.href="/login/spotify"},loginWithTwitch(){window.location.href="/login/twitch"},loginWithGoogle(){window.location.href="/login/google"}}};const x=(0,u.A)(J,[["render",G],["__scopeId","data-v-bd59f260"]]);var V=x,O=i(4232);const R={class:"userlist-container"},T={key:0,class:"modal profile-completion-modal"},N={class:"modal-content"},z={class:"modal-grid"},Q={class:"input-group"},j={class:"input-group"},H={key:1,class:"userlist-card"},K={class:"header-section"},Y={class:"filters"},Z={class:"filters-grid"},ee={class:"input-group"},te={class:"input-group"},ie={class:"filter-buttons"},oe={class:"user-cards-mobile"},se={class:"user-card-header"},ae={class:"user-actions"},ne=["onClick"],re=["onClick"],le={class:"user-card-content"},ue={class:"status-line"},ce={key:0,class:"status-indicator online"},de={key:1,class:"status-indicator offline"},pe={key:2},ge={key:3},he={key:0,class:"listening-container"},me={class:"listening-text"},ke={key:1,style:{"min-height":"20px"}},fe={class:"table-responsive desktop-only"},Le={class:"user-table"},be={class:"status-line"},ve={key:0,class:"status-indicator online"},ye={key:1,class:"status-indicator offline"},we={key:2},Ue={key:3},Ce={key:0,class:"listening-container"},Ee={class:"listening-text"},Se=["onClick"],De=["onClick"],Pe={class:"favorite-tracks-section"},Ae={class:"favorites-grid"},Me=["onClick"],Ie=["src"],_e={class:"track-info"},We={key:0,class:"modal"},Be={class:"modal-content"},Xe={class:"modal-grid"},$e={class:"input-group"},Fe={class:"input-group"},qe={class:"input-group"},Ge={class:"input-group"},Je={class:"input-group"},xe={class:"input-group"};function Ve(e,t,i,a,n,r){return(0,s.uX)(),(0,s.CE)("div",R,[n.showProfileCompletion?((0,s.uX)(),(0,s.CE)("div",T,[(0,s.Lk)("div",N,[t[19]||(t[19]=(0,s.Lk)("h3",{class:"modal-title"},"Completa il tuo profilo",-1)),t[20]||(t[20]=(0,s.Lk)("p",null,"Per continuare, completa i seguenti dati obbligatori:",-1)),(0,s.Lk)("form",{onSubmit:t[2]||(t[2]=(0,o.D$)(((...e)=>r.completeProfile&&r.completeProfile(...e)),["prevent"]))},[(0,s.Lk)("div",z,[(0,s.Lk)("div",Q,[t[16]||(t[16]=(0,s.Lk)("label",{for:"completePosition"},"Posizione:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"completePosition","onUpdate:modelValue":t[0]||(t[0]=e=>n.profileData.Position=e),required:"",class:"cute-input",placeholder:"es. Milano"},null,512),[[o.Jo,n.profileData.Position]])]),(0,s.Lk)("div",j,[t[17]||(t[17]=(0,s.Lk)("label",{for:"completeDateBorn"},"Data di Nascita:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"completeDateBorn",type:"date","onUpdate:modelValue":t[1]||(t[1]=e=>n.profileData.DateBorn=e),required:"",class:"cute-input"},null,512),[[o.Jo,n.profileData.DateBorn]])])]),t[18]||(t[18]=(0,s.Lk)("button",{type:"submit",class:"modal-button"},"Salva e Continua",-1))],32)])])):(0,s.Q3)("",!0),n.showProfileCompletion?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",H,[(0,s.Lk)("div",K,[t[21]||(t[21]=(0,s.Lk)("h2",{class:"title"},"Lista Utenti",-1)),(0,s.Lk)("button",{class:"filter-button",onClick:t[3]||(t[3]=(...e)=>r.logout&&r.logout(...e))},"Logout")]),(0,s.Lk)("div",Y,[t[25]||(t[25]=(0,s.Lk)("h3",{class:"subtitle"},"Filtra Utenti",-1)),(0,s.Lk)("form",{onSubmit:t[7]||(t[7]=(0,o.D$)(((...e)=>r.applicaFiltri&&r.applicaFiltri(...e)),["prevent"]))},[(0,s.Lk)("div",Z,[(0,s.Lk)("div",ee,[t[22]||(t[22]=(0,s.Lk)("label",{for:"position"},"Posizione:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"position","onUpdate:modelValue":t[4]||(t[4]=e=>n.filtri.Position=e),placeholder:"es. Bergamo",class:"cute-input"},null,512),[[o.Jo,n.filtri.Position]])]),(0,s.Lk)("div",te,[t[23]||(t[23]=(0,s.Lk)("label",{for:"dateBorn"},"Data di Nascita:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date",id:"dateBorn","onUpdate:modelValue":t[5]||(t[5]=e=>n.filtri.DateBorn=e),class:"cute-input"},null,512),[[o.Jo,n.filtri.DateBorn]])])]),(0,s.Lk)("div",ie,[t[24]||(t[24]=(0,s.Lk)("button",{type:"submit",class:"filter-button"},"Applica Filtri",-1)),(0,s.Lk)("button",{type:"button",class:"filter-button",onClick:t[6]||(t[6]=(...e)=>r.resettaFiltri&&r.resettaFiltri(...e))}," Reset Filtri ")])],32)]),(0,s.Lk)("div",oe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.utentiFiltrati,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"user-card"},[(0,s.Lk)("div",se,[(0,s.Lk)("strong",null,(0,O.v_)(e.Username),1),(0,s.Lk)("div",ae,[r.puòModificare(e)?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"action-button",onClick:t=>r.modificaUtente(e)}," Modifica ",8,ne)):(0,s.Q3)("",!0),r.puòCancellare(e)?((0,s.uX)(),(0,s.CE)("button",{key:1,class:"action-button delete-button",onClick:t=>r.cancellaUtente(e.id)}," Cancella ",8,re)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",le,[(0,s.Lk)("p",null,[t[26]||(t[26]=(0,s.Lk)("strong",null,"Email Spotify:",-1)),(0,s.eW)(" "+(0,O.v_)(e.emailSpotify),1)]),(0,s.Lk)("p",null,[t[27]||(t[27]=(0,s.Lk)("strong",null,"Email Google:",-1)),(0,s.eW)(" "+(0,O.v_)(e.emailGoogle),1)]),(0,s.Lk)("p",null,[t[28]||(t[28]=(0,s.Lk)("strong",null,"Posizione:",-1)),(0,s.eW)(" "+(0,O.v_)(e.Position),1)]),(0,s.Lk)("p",null,[t[29]||(t[29]=(0,s.Lk)("strong",null,"Data di Nascita:",-1)),(0,s.eW)(" "+(0,O.v_)(e.DateBorn),1)]),(0,s.Lk)("p",ue,[t[30]||(t[30]=(0,s.Lk)("strong",null,"Status:",-1)),r.getUserStatus(e.id).online?((0,s.uX)(),(0,s.CE)("span",ce)):((0,s.uX)(),(0,s.CE)("span",de)),r.getUserStatus(e.id).online?((0,s.uX)(),(0,s.CE)("span",pe,"Online")):((0,s.uX)(),(0,s.CE)("span",ge,"Offline"))]),r.getUserStatus(e.id).listening?((0,s.uX)(),(0,s.CE)("div",he,[t[31]||(t[31]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-headphones"}),(0,s.eW)(" Listening to:")],-1)),(0,s.Lk)("span",me,(0,O.v_)(r.getUserStatus(e.id).listening.trackName)+" by "+(0,O.v_)(r.getUserStatus(e.id).listening.artists),1)])):((0,s.uX)(),(0,s.CE)("div",ke))])])))),128))]),(0,s.Lk)("div",fe,[(0,s.Lk)("table",Le,[t[33]||(t[33]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Username"),(0,s.Lk)("th",null,"Email Spotify"),(0,s.Lk)("th",null,"Email Google"),(0,s.Lk)("th",null,"Posizione"),(0,s.Lk)("th",null,"Data di Nascita"),(0,s.Lk)("th",null,"Status"),(0,s.Lk)("th",null,"Listening"),(0,s.Lk)("th",null,"Azioni")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.utentiFiltrati,(e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",null,(0,O.v_)(e.Username),1),(0,s.Lk)("td",null,(0,O.v_)(e.emailSpotify),1),(0,s.Lk)("td",null,(0,O.v_)(e.emailGoogle),1),(0,s.Lk)("td",null,(0,O.v_)(e.Position),1),(0,s.Lk)("td",null,(0,O.v_)(e.DateBorn),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",be,[r.getUserStatus(e.id).online?((0,s.uX)(),(0,s.CE)("span",ve)):((0,s.uX)(),(0,s.CE)("span",ye)),r.getUserStatus(e.id).online?((0,s.uX)(),(0,s.CE)("span",we,"Online")):((0,s.uX)(),(0,s.CE)("span",Ue,"Offline"))])]),(0,s.Lk)("td",null,[r.getUserStatus(e.id).listening?((0,s.uX)(),(0,s.CE)("div",Ce,[t[32]||(t[32]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-headphones"})],-1)),(0,s.Lk)("span",Ee,(0,O.v_)(r.getUserStatus(e.id).listening.trackName)+" by "+(0,O.v_)(r.getUserStatus(e.id).listening.artists),1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("td",null,[r.puòModificare(e)?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"action-button",onClick:t=>r.modificaUtente(e)}," Modifica ",8,Se)):(0,s.Q3)("",!0),r.puòCancellare(e)?((0,s.uX)(),(0,s.CE)("button",{key:1,class:"action-button delete-button",onClick:t=>r.cancellaUtente(e.id)}," Cancella ",8,De)):(0,s.Q3)("",!0)])])))),128))])])]),(0,s.Lk)("div",Pe,[t[36]||(t[36]=(0,s.Lk)("h3",{class:"subtitle"},"Brani Preferiti",-1)),(0,s.Lk)("div",Ae,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.favorites,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"favorite-track-card",onClick:t=>r.openSpotifyTrack(e)},[e.album&&e.album.images&&e.album.images[0]?((0,s.uX)(),(0,s.CE)("img",{key:0,src:e.album.images[0].url,alt:"Album Art",class:"album-art"},null,8,Ie)):(0,s.Q3)("",!0),(0,s.Lk)("div",_e,[(0,s.Lk)("h4",null,(0,O.v_)(e.name),1),(0,s.Lk)("p",null,[t[34]||(t[34]=(0,s.Lk)("strong",null,"Artista:",-1)),(0,s.eW)(" "+(0,O.v_)(r.getArtistNames(e.artists)),1)]),(0,s.Lk)("p",null,[t[35]||(t[35]=(0,s.Lk)("strong",null,"Album:",-1)),(0,s.eW)(" "+(0,O.v_)(e.album.name),1)])])],8,Me)))),128))])]),n.mostraModaleModifica?((0,s.uX)(),(0,s.CE)("div",We,[(0,s.Lk)("div",Be,[(0,s.Lk)("span",{class:"close",onClick:t[8]||(t[8]=(...e)=>r.chiudiModale&&r.chiudiModale(...e))},"×"),t[44]||(t[44]=(0,s.Lk)("h3",{class:"modal-title"},"Modifica Utente",-1)),(0,s.Lk)("form",{onSubmit:t[15]||(t[15]=(0,o.D$)(((...e)=>r.aggiornaUtente&&r.aggiornaUtente(...e)),["prevent"]))},[(0,s.Lk)("div",Xe,[(0,s.Lk)("div",$e,[t[37]||(t[37]=(0,s.Lk)("label",{for:"editUsername"},"Username:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"editUsername","onUpdate:modelValue":t[9]||(t[9]=e=>n.utenteModificabile.Username=e),required:"",class:"cute-input"},null,512),[[o.Jo,n.utenteModificabile.Username]])]),(0,s.Lk)("div",Fe,[t[38]||(t[38]=(0,s.Lk)("label",{for:"editEmailSpotify"},"Email Spotify:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"editEmailSpotify","onUpdate:modelValue":t[10]||(t[10]=e=>n.utenteModificabile.emailSpotify=e),class:"cute-input"},null,512),[[o.Jo,n.utenteModificabile.emailSpotify]])]),(0,s.Lk)("div",qe,[t[39]||(t[39]=(0,s.Lk)("label",{for:"editEmailGoogle"},"Email Google:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"editEmailGoogle","onUpdate:modelValue":t[11]||(t[11]=e=>n.utenteModificabile.emailGoogle=e),class:"cute-input"},null,512),[[o.Jo,n.utenteModificabile.emailGoogle]])]),(0,s.Lk)("div",Ge,[t[40]||(t[40]=(0,s.Lk)("label",{for:"editPosition"},"Posizione:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"editPosition","onUpdate:modelValue":t[12]||(t[12]=e=>n.utenteModificabile.Position=e),class:"cute-input"},null,512),[[o.Jo,n.utenteModificabile.Position]])]),(0,s.Lk)("div",Je,[t[41]||(t[41]=(0,s.Lk)("label",{for:"editPassword"},"Password:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"editPassword",type:"password","onUpdate:modelValue":t[13]||(t[13]=e=>n.utenteModificabile.Password=e),required:"",class:"cute-input"},null,512),[[o.Jo,n.utenteModificabile.Password]])]),(0,s.Lk)("div",xe,[t[42]||(t[42]=(0,s.Lk)("label",{for:"editDateBorn"},"Data di Nascita:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"editDateBorn",type:"date","onUpdate:modelValue":t[14]||(t[14]=e=>n.utenteModificabile.DateBorn=e),class:"cute-input"},null,512),[[o.Jo,n.utenteModificabile.DateBorn]])])]),t[43]||(t[43]=(0,s.Lk)("button",{type:"submit",class:"modal-button"},"Salva Modifiche",-1))],32)])])):(0,s.Q3)("",!0)]))])}i(2489),i(116),i(1701),i(4603),i(7566),i(8721);var Oe={name:"UserList",data(){return{utenti:[],utentiFiltrati:[],userData:null,mostraModaleModifica:!1,utenteModificabile:{},filtri:{Position:"",DateBorn:""},favorites:[],userId:null,statuses:[],showProfileCompletion:!1,profileData:{Position:"",DateBorn:"",Password:""},currentUserDetails:null}},methods:{async getUserData(){try{const e=await P.A.get("/auth/me",{withCredentials:!0});this.userData=e.data,this.userId=this.userData.userId.toString(),await this.checkRequiredFields()}catch(e){console.error("Errore nel recupero dei dati utente:",e),this.$router.push("/")}},async checkRequiredFields(){try{const e=await this.getUserById(this.userId);e&&e.length>0&&(this.currentUserDetails=e[0],this.currentUserDetails.Position&&this.currentUserDetails.DateBorn?(await this.recuperaUtenti(),this.favorite(),this.setupWebSocket()):(this.profileData.Position=this.currentUserDetails.Position||"",this.profileData.DateBorn=this.currentUserDetails.DateBorn||"",this.showProfileCompletion=!0))}catch(e){console.error("Errore nel controllo dei campi obbligatori:",e)}},async getUserById(e){try{const t=await P.A.get(`/users?id=${e}`,{headers:{userId:this.userId},withCredentials:!0});return t.data}catch(t){return console.error("Errore nel recupero dettagli utente:",t),null}},async completeProfile(){try{this.profileData.Password=this.currentUserDetails.Password||"",await P.A.put(`/users/${this.userId}`,{...this.currentUserDetails,Position:this.profileData.Position,DateBorn:this.profileData.DateBorn,Password:this.profileData.Password},{headers:{userId:this.userId},withCredentials:!0}),this.showProfileCompletion=!1,await this.recuperaUtenti(),this.favorite(),this.setupWebSocket()}catch(e){console.error("Errore nell'aggiornamento del profilo:",e),alert("Impossibile aggiornare il profilo. Riprova più tardi.")}},async recuperaUtenti(){try{const e=await new Promise(((e,t)=>{const i=new XMLHttpRequest;i.open("GET","/users",!0),i.withCredentials=!0,i.setRequestHeader("userId",this.userId),i.onload=function(){i.status>=200&&i.status<300?e(JSON.parse(i.responseText)):t(new Error(i.statusText))},i.onerror=function(){t(new Error("Network Error"))},i.send()}));this.utenti=e.filter((e=>!e.isAdmin)),this.utenti=this.utenti.filter((e=>!e.emailTwitch)),this.utentiFiltrati=this.utenti,console.log("Users loaded:",this.utenti.length)}catch(e){console.error("Errore nel recupero degli utenti:",e),alert("Impossibile recuperare gli utenti.")}},"puòModificare"(e){return e.id===this.userData?.userId},"puòCancellare"(e){return e.id===this.userData?.userId},modificaUtente(e){this.puòModificare(e)?(this.utenteModificabile={...e},this.mostraModaleModifica=!0):alert("Non hai i permessi per modificare questo utente.")},chiudiModale(){this.mostraModaleModifica=!1,this.utenteModificabile={}},async aggiornaUtente(){try{await P.A.put(`/users/${this.utenteModificabile.id}`,{Username:this.utenteModificabile.Username,emailSpotify:this.utenteModificabile.emailSpotify,emailGoogle:this.utenteModificabile.emailGoogle,Position:this.utenteModificabile.Position,Password:this.utenteModificabile.Password,DateBorn:this.utenteModificabile.DateBorn},{headers:{userId:this.userId},withCredentials:!0}),alert("Utente aggiornato con successo."),this.chiudiModale(),this.recuperaUtenti()}catch(e){console.error("Errore nell'aggiornamento dell'utente:",e),e.response&&e.response.data&&e.response.data.message?alert(`Impossibile aggiornare l'utente: ${e.response.data.message}`):alert(`Impossibile aggiornare l'utente: ${e.message}`)}},async cancellaUtente(e){if(confirm("Sei sicuro di voler eliminare il tuo account?"))try{await P.A.delete(`/users/${e}`,{headers:{userId:this.userId},withCredentials:!0}),e===parseInt(this.userId)?(alert("Il tuo account è stato eliminato. Effettua il login di nuovo."),this.logout()):(alert(`Utente con ID "${e}" eliminato con successo.`),this.recuperaUtenti())}catch(t){console.error("Errore nell'eliminazione dell'utente:",t),t.response&&t.response.data&&t.response.data.message?alert(`Impossibile eliminare l'utente: ${t.response.data.message}`):alert(`Impossibile eliminare l'utente: ${t.message}`)}},async logout(){try{await P.A.post("/logout",{},{withCredentials:!0}),this.$router.push("/")}catch(e){console.error("Logout error:",e),alert("Errore durante il logout.")}},applicaFiltri(){const e=new XMLHttpRequest,t=new URLSearchParams;this.filtri.Position&&t.append("Position",this.filtri.Position),this.filtri.DateBorn&&t.append("DateBorn",this.filtri.DateBorn),e.open("GET",`/users?${t.toString()}`,!0),e.withCredentials=!0,e.setRequestHeader("userId",this.userId),e.onload=()=>{e.status>=200&&e.status<300?this.utentiFiltrati=JSON.parse(e.responseText).filter((e=>!e.isAdmin)):(console.error("Error applying filters:",e.statusText),alert("Errore durante l'applicazione dei filtri."))},e.onerror=()=>{console.error("Request failed"),alert("Errore di rete durante l'applicazione dei filtri.")},e.send()},resettaFiltri(){this.filtri.Position="",this.filtri.DateBorn="",this.utentiFiltrati=this.utenti},favorite(){P.A.get("/favorites",{withCredentials:!0}).then((e=>{this.favorites=e.data})).catch((e=>{console.error("Errore nel recupero dei brani preferiti:",e)}))},openSpotifyTrack(e){e&&e.external_urls&&e.external_urls.spotify?window.open(e.external_urls.spotify,"_blank"):alert("Link Spotify non disponibile per questo brano.")},getArtistNames(e){return e&&0!==e.length?e.map((e=>e.name)).join(", "):"Artista sconosciuto"},getUserStatus(e){const t=this.statuses.find((t=>t.userId==e));return t||{}},setupWebSocket(){const e=new WebSocket("ws://localhost:3000");e.onopen=()=>{console.log("WebSocket connection established.")},e.onmessage=e=>{const t=JSON.parse(e.data);"status_update"===t.type&&(this.statuses=t.data)},e.onclose=()=>{console.log("WebSocket connection closed. Reconnecting in 5s..."),setTimeout((()=>this.setupWebSocket()),5e3)},e.onerror=e=>{console.error("WebSocket error:",e)},this.ws=e}},mounted(){this.getUserData()}};const Re=(0,u.A)(Oe,[["render",Ve],["__scopeId","data-v-9cd69e2e"]]);var Te=Re;const Ne={class:"auth-callback"};function ze(e,t,i,o,a,n){return(0,s.uX)(),(0,s.CE)("div",Ne,t[0]||(t[0]=[(0,s.Lk)("p",null,"Autenticazione in corso...",-1)]))}var Qe={name:"AuthCallback",async mounted(){try{const e=await P.A.get("/auth/me",{withCredentials:!0});if(!e.data)throw new Error("Authentication failed");e.data.isAdmin?this.$router.push("/admin"):this.$router.push("/users")}catch(e){console.error("Authentication error:",e),alert("Authentication failed. Please try again."),this.$router.push("/")}}};const je=(0,u.A)(Qe,[["render",ze],["__scopeId","data-v-06f37210"]]);var He=je;const Ke={class:"admin-container"},Ye={class:"admin-card"},Ze={class:"header-section"},et={class:"users-cards"},tt={class:"user-card-header"},it={class:"user-actions"},ot=["onClick"],st=["onClick"],at={class:"user-card-content"},nt={key:0,class:"modal"},rt={class:"modal-content"},lt={class:"modal-grid"},ut={class:"input-group"},ct={class:"input-group"},dt={class:"input-group"},pt={class:"input-group checkbox-group"},gt={class:"modal-buttons"};function ht(e,t,i,a,n,r){return(0,s.uX)(),(0,s.CE)("div",Ke,[(0,s.Lk)("div",Ye,[(0,s.Lk)("div",Ze,[t[8]||(t[8]=(0,s.Lk)("h1",{class:"title"},"Admin Dashboard",-1)),(0,s.Lk)("button",{class:"logout-button",onClick:t[0]||(t[0]=(...e)=>r.logout&&r.logout(...e))},"Logout")]),(0,s.Lk)("div",et,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.users,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"user-card"},[(0,s.Lk)("div",tt,[(0,s.Lk)("strong",null,(0,O.v_)(e.Username),1),(0,s.Lk)("div",it,[(0,s.Lk)("button",{onClick:t=>r.editUser(e),class:"action-button edit-button"}," Edit ",8,ot),(0,s.Lk)("button",{onClick:t=>r.deleteUser(e.id),class:"action-button delete-button"}," Delete ",8,st)])]),(0,s.Lk)("div",at,[(0,s.Lk)("p",null,[t[9]||(t[9]=(0,s.Lk)("strong",null,"Email Spotify:",-1)),(0,s.eW)(" "+(0,O.v_)(e.emailSpotify),1)]),(0,s.Lk)("p",null,[t[10]||(t[10]=(0,s.Lk)("strong",null,"Email Twitch:",-1)),(0,s.eW)(" "+(0,O.v_)(e.emailTwitch),1)]),(0,s.Lk)("p",null,[t[11]||(t[11]=(0,s.Lk)("strong",null,"Email Google:",-1)),(0,s.eW)(" "+(0,O.v_)(e.emailGoogle),1)]),(0,s.Lk)("p",null,[t[12]||(t[12]=(0,s.Lk)("strong",null,"Position:",-1)),(0,s.eW)(" "+(0,O.v_)(e.Position),1)]),(0,s.Lk)("p",null,[t[13]||(t[13]=(0,s.Lk)("strong",null,"Date Born:",-1)),(0,s.eW)(" "+(0,O.v_)(r.formatDate(e.DateBorn)),1)]),(0,s.Lk)("p",null,[t[14]||(t[14]=(0,s.Lk)("strong",null,"Admin:",-1)),(0,s.eW)(" "+(0,O.v_)(e.isAdmin?"Yes":"No"),1)])])])))),128))]),n.showModal?((0,s.uX)(),(0,s.CE)("div",nt,[(0,s.Lk)("div",rt,[(0,s.Lk)("span",{class:"close",onClick:t[1]||(t[1]=(...e)=>r.closeModal&&r.closeModal(...e))},"×"),t[20]||(t[20]=(0,s.Lk)("h2",null,"Edit User",-1)),(0,s.Lk)("form",{onSubmit:t[7]||(t[7]=(0,o.D$)(((...e)=>r.updateUser&&r.updateUser(...e)),["prevent"]))},[(0,s.Lk)("div",lt,[(0,s.Lk)("div",ut,[t[15]||(t[15]=(0,s.Lk)("label",null,"Username:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.editingUser.Username=e),type:"text",required:"",class:"cute-input"},null,512),[[o.Jo,n.editingUser.Username]])]),(0,s.Lk)("div",ct,[t[16]||(t[16]=(0,s.Lk)("label",null,"Position:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>n.editingUser.Position=e),type:"text",class:"cute-input"},null,512),[[o.Jo,n.editingUser.Position]])]),(0,s.Lk)("div",dt,[t[17]||(t[17]=(0,s.Lk)("label",null,"Date Born:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>n.editingUser.DateBorn=e),type:"date",class:"cute-input"},null,512),[[o.Jo,n.editingUser.DateBorn]])]),(0,s.Lk)("div",pt,[t[18]||(t[18]=(0,s.Lk)("label",null,"Is Admin:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>n.editingUser.isAdmin=e),type:"checkbox"},null,512),[[o.lH,n.editingUser.isAdmin]])])]),(0,s.Lk)("div",gt,[t[19]||(t[19]=(0,s.Lk)("button",{type:"submit",class:"save-btn"},"Save",-1)),(0,s.Lk)("button",{type:"button",onClick:t[6]||(t[6]=(...e)=>r.closeModal&&r.closeModal(...e)),class:"cancel-btn"}," Cancel ")])],32)])])):(0,s.Q3)("",!0)])])}var mt={name:"AdminPage",data(){return{users:[],showModal:!1,editingUser:{}}},async created(){await this.loadUsers()},methods:{async loadUsers(){try{const e=await P.A.get("/users",{withCredentials:!0});this.users=e.data}catch(e){console.error("Error loading users:",e),alert("Error loading users")}},editUser(e){this.editingUser={...e},this.showModal=!0},closeModal(){this.showModal=!1,this.editingUser={}},async updateUser(){try{await P.A.put(`/users/${this.editingUser.id}`,this.editingUser,{withCredentials:!0,headers:{isadmin:"true",userid:this.editingUser.id}}),await this.loadUsers(),this.closeModal()}catch(e){console.error("Error updating user:",e),alert("Error updating user")}},async deleteUser(e){if(confirm("Are you sure you want to delete this user?"))try{await P.A.delete(`/users/${e}`,{withCredentials:!0,headers:{isadmin:"true",userid:e}}),await this.loadUsers()}catch(t){console.error("Error deleting user:",t),alert("Error deleting user")}},formatDate(e){const t={year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString(void 0,t)},async logout(){try{await P.A.post("/logout",{},{withCredentials:!0}),this.$router.push("/")}catch(e){console.error("Logout error:",e),alert("Error during logout.")}}}};const kt=(0,u.A)(mt,[["render",ht],["__scopeId","data-v-6ec6a3b6"]]);var ft=kt;const Lt=[{path:"/",name:"login",component:V},{path:"/register",name:"register",component:I},{path:"/users",name:"userlist",component:Te,meta:{requiresAuth:!0}},{path:"/auth/callback",name:"auth-callback",component:He},{path:"/:pathMatch(.*)*",redirect:"/"},{path:"/admin",name:"admin",component:ft,meta:{requiresAuth:!0,requiresAdmin:!0}}],bt=(0,g.aE)({history:(0,g.LA)("/"),routes:Lt});bt.beforeEach((async(e,t,i)=>{const o=e.matched.some((e=>e.meta.requiresAuth)),s=e.matched.some((e=>e.meta.requiresAdmin)),a="login"===e.name||"register"===e.name;try{const e=await P.A.get("/auth/check-session",{withCredentials:!0});console.log("Auth check response:",e.data);const t=e.data.authenticated,n=Boolean(e.data.user?.isAdmin);console.log("isAuthenticated:",t,"isAdmin:",n),o&&!t?i({name:"login"}):s&&!n?i({name:"userlist"}):a&&t?i({name:n?"admin":"userlist"}):i()}catch(n){console.error("Auth check error:",n),o?i({name:"login"}):i()}}));var vt=bt,yt=i(782),wt=(0,yt.y$)({state:{},getters:{},mutations:{},actions:{},modules:{}});(0,o.Ef)(p).use(wt).use(vt).mount("#app")}},t={};function i(o){var s=t[o];if(void 0!==s)return s.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,i),a.exports}i.m=e,function(){var e=[];i.O=function(t,o,s,a){if(!o){var n=1/0;for(c=0;c<e.length;c++){o=e[c][0],s=e[c][1],a=e[c][2];for(var r=!0,l=0;l<o.length;l++)(!1&a||n>=a)&&Object.keys(i.O).every((function(e){return i.O[e](o[l])}))?o.splice(l--,1):(r=!1,a<n&&(n=a));if(r){e.splice(c--,1);var u=s();void 0!==u&&(t=u)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[o,s,a]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){i.p="/"}(),function(){var e={524:0};i.O.j=function(t){return 0===e[t]};var t=function(t,o){var s,a,n=o[0],r=o[1],l=o[2],u=0;if(n.some((function(t){return 0!==e[t]}))){for(s in r)i.o(r,s)&&(i.m[s]=r[s]);if(l)var c=l(i)}for(t&&t(o);u<n.length;u++)a=n[u],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(c)},o=self["webpackChunksite2"]=self["webpackChunksite2"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=i.O(void 0,[504],(function(){return i(6455)}));o=i.O(o)})();
//# sourceMappingURL=app.7eb1e731.js.map