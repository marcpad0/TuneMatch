(()=>{"use strict";var e={6212:(e,t,r)=>{r(3792),r(3362),r(9085),r(9391);var n=r(5130),s=r(6768),a={id:"app"},i={class:"navbar"},o={class:"navbar-container"},l={class:"navbar-links"},c={class:"content"};function u(e,t,r,u,d,p){var f=(0,s.g2)("router-link"),h=(0,s.g2)("router-view");return(0,s.uX)(),(0,s.CE)("div",a,[(0,s.Lk)("nav",i,[(0,s.Lk)("div",o,[(0,s.bF)(f,{to:"/",class:"navbar-brand"},{default:(0,s.k6)((function(){return t[1]||(t[1]=[(0,s.Lk)("span",{class:"logo-icon"},"‚ô™",-1),(0,s.Lk)("span",{class:"brand-name"},"TuneMatch",-1)])})),_:1}),(0,s.Lk)("div",l,[d.isAuthenticated?((0,s.uX)(),(0,s.CE)("a",{key:1,href:"#",onClick:t[0]||(t[0]=(0,n.D$)((function(){return p.logout&&p.logout.apply(p,arguments)}),["prevent"])),class:"logout-link"},"Logout")):((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.bF)(f,{to:"/register"},{default:(0,s.k6)((function(){return t[2]||(t[2]=[(0,s.eW)("Register")])})),_:1}),(0,s.bF)(f,{to:"/"},{default:(0,s.k6)((function(){return t[3]||(t[3]=[(0,s.eW)("Login")])})),_:1})],64))])])]),(0,s.Lk)("main",c,[(0,s.bF)(h)])])}var d=r(4048),p=r(388),f=(r(4114),r(6966));const h={data:function(){return{isAuthenticated:!1}},methods:{checkAuthStatus:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){var r;return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,f.A.get("/auth/check-session",{withCredentials:!0});case 3:r=t.sent,e.isAuthenticated=r.data.authenticated,t.next=11;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("Auth check error:",t.t0),e.isAuthenticated=!1;case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()},logout:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,f.A.post("/logout",{},{withCredentials:!0});case 3:e.isAuthenticated=!1,e.$router.push("/"),t.next=11;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("Logout error:",t.t0),alert("Error during logout. Please try again.");case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()}},mounted:function(){var e=this;this.checkAuthStatus(),this.$router.beforeEach((function(t,r,n){e.checkAuthStatus(),n()}))}};var v=r(1241);const k=(0,v.A)(h,[["render",u]]),m=k;r(5086),r(2010),r(6099);var g=r(1387),L={class:"login-container"},b={class:"login-card"},y={class:"input-group"},w={class:"input-wrapper"},A={class:"input-group"},C={class:"input-wrapper"},U={class:"input-group"},S={class:"input-wrapper"},D={class:"input-group"},x={class:"input-wrapper"},E={class:"input-group"},F={class:"input-wrapper"},P={class:"social-logins"},M={class:"register-link"};function I(e,t,r,a,i,o){var l=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",L,[(0,s.Lk)("div",b,[t[23]||(t[23]=(0,s.Lk)("h2",{class:"title"},"Registrati",-1)),(0,s.Lk)("form",{onSubmit:t[5]||(t[5]=(0,n.D$)((function(){return o.registerUser&&o.registerUser.apply(o,arguments)}),["prevent"]))},[(0,s.Lk)("div",y,[t[9]||(t[9]=(0,s.Lk)("label",{for:"username"},"Username",-1)),(0,s.Lk)("div",w,[t[8]||(t[8]=(0,s.Lk)("span",{class:"input-icon"},"üë§",-1)),(0,s.bo)((0,s.Lk)("input",{id:"username","onUpdate:modelValue":t[0]||(t[0]=function(e){return i.username=e}),type:"text",placeholder:"Inserisci il tuo username",required:""},null,512),[[n.Jo,i.username]])])]),(0,s.Lk)("div",A,[t[11]||(t[11]=(0,s.Lk)("label",{for:"email"},"Email",-1)),(0,s.Lk)("div",C,[t[10]||(t[10]=(0,s.Lk)("span",{class:"input-icon"},"üìß",-1)),(0,s.bo)((0,s.Lk)("input",{id:"email","onUpdate:modelValue":t[1]||(t[1]=function(e){return i.email=e}),type:"email",placeholder:"Inserisci la tua email",required:""},null,512),[[n.Jo,i.email]])])]),(0,s.Lk)("div",U,[t[13]||(t[13]=(0,s.Lk)("label",{for:"position"},"Posizione",-1)),(0,s.Lk)("div",S,[t[12]||(t[12]=(0,s.Lk)("span",{class:"input-icon"},"üìç",-1)),(0,s.bo)((0,s.Lk)("input",{id:"position","onUpdate:modelValue":t[2]||(t[2]=function(e){return i.position=e}),type:"text",placeholder:"Inserisci la tua posizione",required:""},null,512),[[n.Jo,i.position]])])]),(0,s.Lk)("div",D,[t[15]||(t[15]=(0,s.Lk)("label",{for:"dateBorn"},"Data di Nascita",-1)),(0,s.Lk)("div",x,[t[14]||(t[14]=(0,s.Lk)("span",{class:"input-icon"},"üóìÔ∏è",-1)),(0,s.bo)((0,s.Lk)("input",{id:"dateBorn","onUpdate:modelValue":t[3]||(t[3]=function(e){return i.dateBorn=e}),type:"date",required:""},null,512),[[n.Jo,i.dateBorn]])])]),(0,s.Lk)("div",E,[t[17]||(t[17]=(0,s.Lk)("label",{for:"password"},"Password",-1)),(0,s.Lk)("div",F,[t[16]||(t[16]=(0,s.Lk)("span",{class:"input-icon"},"üîí",-1)),(0,s.bo)((0,s.Lk)("input",{id:"password","onUpdate:modelValue":t[4]||(t[4]=function(e){return i.password=e}),type:"password",placeholder:"Inserisci la tua password",required:""},null,512),[[n.Jo,i.password]])])]),t[18]||(t[18]=(0,s.Lk)("button",{type:"submit",class:"login-button"},[(0,s.Lk)("span",null,"Registrati")],-1))],32),t[24]||(t[24]=(0,s.Lk)("div",{class:"divider"},[(0,s.Lk)("span",null,"oppure")],-1)),(0,s.Lk)("div",P,[(0,s.Lk)("button",{onClick:t[6]||(t[6]=function(){return o.loginWithSpotify&&o.loginWithSpotify.apply(o,arguments)}),class:"spotify-button social-button"},t[19]||(t[19]=[(0,s.Lk)("span",{class:"social-icon"},"üéµ",-1),(0,s.eW)(" Accedi con Spotify ")])),(0,s.Lk)("button",{onClick:t[7]||(t[7]=function(){return o.loginWithGoogle&&o.loginWithGoogle.apply(o,arguments)}),class:"google-button social-button"},t[20]||(t[20]=[(0,s.Lk)("span",{class:"social-icon"},"G",-1),(0,s.eW)(" Accedi con Google ")]))]),(0,s.Lk)("p",M,[t[22]||(t[22]=(0,s.eW)(" Hai gi√† un account? ")),(0,s.bF)(l,{to:"/"},{default:(0,s.k6)((function(){return t[21]||(t[21]=[(0,s.eW)("Accedi")])})),_:1})])])])}const _={name:"todo-item",data:function(){return{username:"",email:"",position:"",password:"",dateBorn:""}},methods:{registerUser:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,f.A.post("/users",{Username:e.username,Email:e.email,Position:e.position,Password:e.password,DateBorn:e.dateBorn});case 3:t.sent,e.$router.push("/"),t.next=11;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("Errore durante la registrazione:",t.t0),t.t0.response&&409===t.t0.response.status?alert("Registrazione fallita: Nome utente o email gi√† in uso."):t.t0.response&&t.t0.response.data&&t.t0.response.data.message?alert("Registrazione fallita: ".concat(t.t0.response.data.message)):alert("Registrazione fallita. Riprova pi√π tardi.");case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()},loginWithSpotify:function(){window.location.href="/auth/spotify"},loginWithTwitch:function(){window.location.href="/auth/Twitch"},loginWithGoogle:function(){window.location.href="/auth/google"}}},X=(0,v.A)(_,[["render",I],["__scopeId","data-v-19456512"]]),z=X;var B={class:"login-container"},W={class:"login-card"},T={class:"input-group"},Q={class:"input-wrapper"},R={class:"input-group"},q={class:"input-wrapper"},O={class:"social-logins"},N={class:"register-link"};function J(e,t,r,a,i,o){var l=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",B,[(0,s.Lk)("div",W,[t[14]||(t[14]=(0,s.Lk)("h2",{class:"title"},"Accedi",-1)),(0,s.Lk)("form",{onSubmit:t[2]||(t[2]=(0,n.D$)((function(){return o.loginUser&&o.loginUser.apply(o,arguments)}),["prevent"]))},[(0,s.Lk)("div",T,[t[6]||(t[6]=(0,s.Lk)("label",{for:"username"},"Username",-1)),(0,s.Lk)("div",Q,[t[5]||(t[5]=(0,s.Lk)("span",{class:"input-icon"},"üë§",-1)),(0,s.bo)((0,s.Lk)("input",{id:"username","onUpdate:modelValue":t[0]||(t[0]=function(e){return i.username=e}),type:"text",placeholder:"Inserisci il tuo username",required:""},null,512),[[n.Jo,i.username]])])]),(0,s.Lk)("div",R,[t[8]||(t[8]=(0,s.Lk)("label",{for:"password"},"Password",-1)),(0,s.Lk)("div",q,[t[7]||(t[7]=(0,s.Lk)("span",{class:"input-icon"},"üîí",-1)),(0,s.bo)((0,s.Lk)("input",{id:"password","onUpdate:modelValue":t[1]||(t[1]=function(e){return i.password=e}),type:"password",placeholder:"Inserisci la tua password",required:""},null,512),[[n.Jo,i.password]])])]),t[9]||(t[9]=(0,s.Lk)("button",{type:"submit",class:"login-button"}," Login ",-1))],32),t[15]||(t[15]=(0,s.Lk)("div",{class:"divider"},[(0,s.Lk)("span",null,"oppure")],-1)),(0,s.Lk)("div",O,[(0,s.Lk)("button",{onClick:t[3]||(t[3]=function(){return o.loginWithSpotify&&o.loginWithSpotify.apply(o,arguments)}),class:"spotify-button social-button"},t[10]||(t[10]=[(0,s.Lk)("span",{class:"social-icon"},"üéµ",-1),(0,s.eW)(" Accedi con Spotify ")])),(0,s.Lk)("button",{onClick:t[4]||(t[4]=function(){return o.loginWithGoogle&&o.loginWithGoogle.apply(o,arguments)}),class:"google-button social-button"},t[11]||(t[11]=[(0,s.Lk)("span",{class:"social-icon"},"G",-1),(0,s.eW)(" Accedi con Google ")]))]),(0,s.Lk)("p",N,[t[13]||(t[13]=(0,s.eW)(" Non hai un account? ")),(0,s.bF)(l,{to:"/register"},{default:(0,s.k6)((function(){return t[12]||(t[12]=[(0,s.eW)("Registrati")])})),_:1})])])])}const K={name:"todo-item",data:function(){return{username:"",password:""}},methods:{loginUser:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){var r,n;return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,f.A.post("/login",{Username:e.username,Password:e.password},{withCredentials:!0});case 3:return t.next=5,f.A.get("/auth/me",{withCredentials:!0});case 5:r=t.sent,r.data&&r.data.isAdmin?e.$router.push("/admin"):e.$router.push("/users"),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](0),console.error(t.t0),null!==(n=t.t0.response)&&void 0!==n&&null!==(n=n.data)&&void 0!==n&&n.message?alert("Login fallito: ".concat(t.t0.response.data.message)):alert("Login fallito: ".concat(t.t0.message));case 13:case"end":return t.stop()}}),t,null,[[0,9]])})))()},loginWithSpotify:function(){window.location.href="/login/spotify"},loginWithTwitch:function(){window.location.href="/login/twitch"},loginWithGoogle:function(){window.location.href="/login/google"}}},$=(0,v.A)(K,[["render",J],["__scopeId","data-v-dbf98a88"]]),V=$;r(3288);var G=r(4232),j={class:"userlist-container"},H={key:0,class:"modal profile-completion-modal"},Y={class:"modal-content"},Z={class:"modal-grid"},ee={class:"input-group"},te={class:"input-group"},re={key:1,class:"modal favorite-selection-modal"},ne={class:"modal-content"},se={class:"deezer-search-container"},ae=["disabled"],ie={key:0,class:"error-message"},oe={key:1,class:"deezer-results-container"},le={class:"results-grid"},ce=["onClick"],ue=["src","alt"],de={key:1,class:"result-image-placeholder"},pe={class:"result-info"},fe={class:"result-name"},he={class:"result-artist"},ve={key:2,class:"selected-indicator"},ke={key:2,class:"no-results"},me={key:3,class:"selected-favorites-container"},ge={class:"selected-items-grid"},Le=["onClick"],be={key:4,class:"error-message"},ye=["disabled"],we={key:2,class:"userlist-card"},Ae={class:"header-section"},Ce={class:"search-container"},Ue={class:"filters"},Se={class:"filters-grid"},De={class:"input-group"},xe={class:"input-group"},Ee={class:"input-group"},Fe={class:"filter-buttons"},Pe={class:"user-cards-mobile"},Me={class:"user-card-header"},Ie={key:0,class:"admin-badge"},_e={class:"user-card-content"},Xe={key:0},ze={class:"status-line"},Be={key:0,class:"status-indicator online"},We={key:1,class:"status-indicator offline"},Te={key:2},Qe={key:3},Re={key:1,class:"listening-container"},qe={class:"listening-text"},Oe={key:2,style:{"min-height":"20px"}},Ne={key:0,class:"spotify-notice"},Je={class:"spotify-notice-content"},Ke={key:0,class:"update-time"},$e={class:"table-responsive desktop-only"},Ve={class:"user-table"},Ge={key:0},je={key:0},He={key:0},Ye={key:0,class:"admin-badge"},Ze={class:"status-line"},et={key:0,class:"status-indicator online"},tt={key:1,class:"status-indicator offline"},rt={key:2},nt={key:3},st={key:0,class:"listening-container"},at={class:"listening-text"};function it(e,t,r,a,i,o){var l=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",j,[i.showProfileCompletion?((0,s.uX)(),(0,s.CE)("div",H,[(0,s.Lk)("div",Y,[t[19]||(t[19]=(0,s.Lk)("h3",{class:"modal-title"},"Completa il tuo profilo",-1)),t[20]||(t[20]=(0,s.Lk)("p",null,"Per continuare, completa i seguenti dati obbligatori:",-1)),(0,s.Lk)("form",{onSubmit:t[2]||(t[2]=(0,n.D$)((function(){return o.completeProfile&&o.completeProfile.apply(o,arguments)}),["prevent"]))},[(0,s.Lk)("div",Z,[(0,s.Lk)("div",ee,[t[16]||(t[16]=(0,s.Lk)("label",{for:"completePosition"},"Posizione:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"completePosition","onUpdate:modelValue":t[0]||(t[0]=function(e){return i.profileData.Position=e}),required:"",class:"cute-input",placeholder:"es. Milano"},null,512),[[n.Jo,i.profileData.Position]])]),(0,s.Lk)("div",te,[t[17]||(t[17]=(0,s.Lk)("label",{for:"completeDateBorn"},"Data di Nascita:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"completeDateBorn",type:"date","onUpdate:modelValue":t[1]||(t[1]=function(e){return i.profileData.DateBorn=e}),required:"",class:"cute-input"},null,512),[[n.Jo,i.profileData.DateBorn]])])]),t[18]||(t[18]=(0,s.Lk)("button",{type:"submit",class:"modal-button"},"Salva e Continua",-1))],32)])])):(0,s.Q3)("",!0),i.showFavoriteSelectionModal?((0,s.uX)(),(0,s.CE)("div",re,[(0,s.Lk)("div",ne,[t[22]||(t[22]=(0,s.Lk)("h2",{class:"modal-title"},"Select Your Music Preferences",-1)),t[23]||(t[23]=(0,s.Lk)("p",{class:"modal-subtitle"},"Search for your favorite tracks (max 3 selections).",-1)),(0,s.Lk)("div",se,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=function(e){return i.deezerSearchQuery=e}),placeholder:"Search tracks on Deezer...",onKeyup:t[4]||(t[4]=(0,n.jR)((function(){return o.searchDeezer&&o.searchDeezer.apply(o,arguments)}),["enter"])),class:"cute-input"},null,544),[[n.Jo,i.deezerSearchQuery]]),(0,s.Lk)("button",{onClick:t[5]||(t[5]=function(){return o.searchDeezer&&o.searchDeezer.apply(o,arguments)}),disabled:i.isLoadingDeezer,class:"search-button"},(0,G.v_)(i.isLoadingDeezer?"Searching...":"Search"),9,ae)]),i.deezerSearchError?((0,s.uX)(),(0,s.CE)("div",ie,(0,G.v_)(i.deezerSearchError),1)):(0,s.Q3)("",!0),i.deezerSearchResults.length>0?((0,s.uX)(),(0,s.CE)("div",oe,[t[21]||(t[21]=(0,s.Lk)("p",null,"Search Results:",-1)),(0,s.Lk)("div",le,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.deezerSearchResults,(function(e){return(0,s.uX)(),(0,s.CE)("div",{key:e.id,class:(0,G.C4)(["result-item",{selected:o.isSelectedFavorite(e)}]),onClick:function(t){return o.toggleFavoriteSelection(e)}},[e.imageUrl?((0,s.uX)(),(0,s.CE)("img",{key:0,src:e.imageUrl,alt:e.name,class:"result-image"},null,8,ue)):((0,s.uX)(),(0,s.CE)("div",de,"No Image")),(0,s.Lk)("div",pe,[(0,s.Lk)("span",fe,(0,G.v_)(e.name),1),(0,s.Lk)("span",he,(0,G.v_)(e.artist),1)]),o.isSelectedFavorite(e)?((0,s.uX)(),(0,s.CE)("span",ve,"‚úì")):(0,s.Q3)("",!0)],10,ce)})),128))])])):!i.isLoadingDeezer&&i.hasSearchedDeezer?((0,s.uX)(),(0,s.CE)("div",ke," No results found. Try a different search. ")):(0,s.Q3)("",!0),i.selectedFavorites.length>0?((0,s.uX)(),(0,s.CE)("div",me,[(0,s.Lk)("p",null,"Your Selections ("+(0,G.v_)(i.selectedFavorites.length)+"/3):",1),(0,s.Lk)("div",ge,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.selectedFavorites,(function(e){return(0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"selected-item"},[(0,s.Lk)("span",null,(0,G.v_)(e.name)+" - "+(0,G.v_)(e.artist),1),(0,s.Lk)("button",{onClick:function(t){return o.removeSelectedFavorite(e)},class:"remove-button"},"√ó",8,Le)])})),128))])])):(0,s.Q3)("",!0),i.favoriteSelectionError?((0,s.uX)(),(0,s.CE)("div",be,(0,G.v_)(i.favoriteSelectionError),1)):(0,s.Q3)("",!0),(0,s.Lk)("button",{onClick:t[6]||(t[6]=function(){return o.saveSelectedFavorites&&o.saveSelectedFavorites.apply(o,arguments)}),class:"modal-button save-favorites-button",disabled:0===i.selectedFavorites.length&&!i.hasPreviouslySavedFavorites}," Save Preferences ",8,ye)])])):(0,s.Q3)("",!0),i.showProfileCompletion||i.showFavoriteSelectionModal?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",we,[(0,s.Lk)("div",Ae,[t[24]||(t[24]=(0,s.Lk)("h2",{class:"title"},"Lista Utenti",-1)),(0,s.Lk)("div",Ce,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=function(e){return i.searchTerm=e}),placeholder:"Cerca utenti...",class:"cute-input search-input"},null,512),[[n.Jo,i.searchTerm]])])]),(0,s.Lk)("div",Ue,[t[29]||(t[29]=(0,s.Lk)("h3",{class:"subtitle"},"Filtra Utenti",-1)),(0,s.Lk)("form",{onSubmit:t[12]||(t[12]=(0,n.D$)((function(){return o.applicaFiltri&&o.applicaFiltri.apply(o,arguments)}),["prevent"]))},[(0,s.Lk)("div",Se,[(0,s.Lk)("div",De,[t[25]||(t[25]=(0,s.Lk)("label",{for:"filterUsername"},"Username:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"filterUsername","onUpdate:modelValue":t[8]||(t[8]=function(e){return i.filtri.Username=e}),placeholder:"es. mario.rossi",class:"cute-input"},null,512),[[n.Jo,i.filtri.Username]])]),(0,s.Lk)("div",xe,[t[26]||(t[26]=(0,s.Lk)("label",{for:"position"},"Posizione:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"position","onUpdate:modelValue":t[9]||(t[9]=function(e){return i.filtri.Position=e}),placeholder:"es. Bergamo",class:"cute-input"},null,512),[[n.Jo,i.filtri.Position]])]),(0,s.Lk)("div",Ee,[t[27]||(t[27]=(0,s.Lk)("label",{for:"dateBorn"},"Data di Nascita:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date",id:"dateBorn","onUpdate:modelValue":t[10]||(t[10]=function(e){return i.filtri.DateBorn=e}),class:"cute-input"},null,512),[[n.Jo,i.filtri.DateBorn]])])]),(0,s.Lk)("div",Fe,[t[28]||(t[28]=(0,s.Lk)("button",{type:"submit",class:"filter-button"},"Applica Filtri",-1)),(0,s.Lk)("button",{type:"button",class:"filter-button",onClick:t[11]||(t[11]=function(){return o.resettaFiltri&&o.resettaFiltri.apply(o,arguments)})}," Reset Filtri ")])],32)]),(0,s.Lk)("div",Pe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.processedUtenti,(function(e){return(0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"user-card"},[(0,s.Lk)("div",Me,[(0,s.bF)(l,{to:{name:"profile",params:{userId:e.id}},class:"user-profile-link"},{default:(0,s.k6)((function(){return[(0,s.Lk)("strong",null,(0,G.v_)(e.Username),1)]})),_:2},1032,["to"]),e.isAdmin?((0,s.uX)(),(0,s.CE)("span",Ie,"Admin")):(0,s.Q3)("",!0)]),(0,s.Lk)("div",_e,[(0,s.Lk)("p",null,[t[30]||(t[30]=(0,s.Lk)("strong",null,"Posizione:",-1)),(0,s.eW)(" "+(0,G.v_)(e.Position),1)]),(0,s.Lk)("p",null,[t[31]||(t[31]=(0,s.Lk)("strong",null,"Data di Nascita:",-1)),(0,s.eW)(" "+(0,G.v_)(e.DateBorn),1)]),e.isAdmin?((0,s.uX)(),(0,s.CE)("p",Xe,t[32]||(t[32]=[(0,s.Lk)("strong",null,"Ruolo:",-1),(0,s.eW)(" Amministratore")]))):(0,s.Q3)("",!0),(0,s.Lk)("p",ze,[t[33]||(t[33]=(0,s.Lk)("strong",null,"Status:",-1)),o.getUserStatus(e.id).online?((0,s.uX)(),(0,s.CE)("span",Be)):((0,s.uX)(),(0,s.CE)("span",We)),o.getUserStatus(e.id).online?((0,s.uX)(),(0,s.CE)("span",Te,"Online")):((0,s.uX)(),(0,s.CE)("span",Qe,"Offline"))]),o.getUserStatus(e.id).listening?((0,s.uX)(),(0,s.CE)("div",Re,[t[34]||(t[34]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-headphones"}),(0,s.eW)(" Listening to:")],-1)),(0,s.Lk)("span",qe,(0,G.v_)(o.getUserStatus(e.id).listening.trackName)+" by "+(0,G.v_)(o.getUserStatus(e.id).listening.artists),1)])):((0,s.uX)(),(0,s.CE)("div",Oe))])])})),128))]),i.isSpotifyUser&&i.spotifyFavorites.length>0?((0,s.uX)(),(0,s.CE)("div",Ne,[(0,s.Lk)("div",Je,[t[37]||(t[37]=(0,s.Lk)("i",{class:"fab fa-spotify spotify-icon"},null,-1)),(0,s.Lk)("div",null,[t[35]||(t[35]=(0,s.Lk)("h4",null,"Spotify Integration Active",-1)),t[36]||(t[36]=(0,s.Lk)("p",null,"Your favorite tracks are automatically synchronized from Spotify.",-1)),i.spotifyFavoritesLastUpdated?((0,s.uX)(),(0,s.CE)("p",Ke," Last updated: "+(0,G.v_)(new Date(i.spotifyFavoritesLastUpdated).toLocaleString()),1)):(0,s.Q3)("",!0)])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",$e,[(0,s.Lk)("table",Ve,[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",{onClick:t[13]||(t[13]=function(e){return o.sortBy("Username")}),class:"sortable-header"},[t[38]||(t[38]=(0,s.eW)(" Username ")),"Username"===i.sortKey?((0,s.uX)(),(0,s.CE)("span",Ge,(0,G.v_)(i.sortAsc?"‚ñ≤":"‚ñº"),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("th",{onClick:t[14]||(t[14]=function(e){return o.sortBy("Position")}),class:"sortable-header"},[t[39]||(t[39]=(0,s.eW)(" Posizione ")),"Position"===i.sortKey?((0,s.uX)(),(0,s.CE)("span",je,(0,G.v_)(i.sortAsc?"‚ñ≤":"‚ñº"),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("th",{onClick:t[15]||(t[15]=function(e){return o.sortBy("DateBorn")}),class:"sortable-header"},[t[40]||(t[40]=(0,s.eW)(" Data di Nascita ")),"DateBorn"===i.sortKey?((0,s.uX)(),(0,s.CE)("span",He,(0,G.v_)(i.sortAsc?"‚ñ≤":"‚ñº"),1)):(0,s.Q3)("",!0)]),t[41]||(t[41]=(0,s.Lk)("th",null,"Status",-1)),t[42]||(t[42]=(0,s.Lk)("th",null,"Listening",-1))])]),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.processedUtenti,(function(e){return(0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",null,[(0,s.bF)(l,{to:{name:"profile",params:{userId:e.id}},class:"user-profile-link"},{default:(0,s.k6)((function(){return[(0,s.eW)((0,G.v_)(e.Username),1)]})),_:2},1032,["to"]),e.isAdmin?((0,s.uX)(),(0,s.CE)("span",Ye,"Admin")):(0,s.Q3)("",!0)]),(0,s.Lk)("td",null,(0,G.v_)(e.Position),1),(0,s.Lk)("td",null,(0,G.v_)(e.DateBorn),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",Ze,[o.getUserStatus(e.id).online?((0,s.uX)(),(0,s.CE)("span",et)):((0,s.uX)(),(0,s.CE)("span",tt)),o.getUserStatus(e.id).online?((0,s.uX)(),(0,s.CE)("span",rt,"Online")):((0,s.uX)(),(0,s.CE)("span",nt,"Offline"))])]),(0,s.Lk)("td",null,[o.getUserStatus(e.id).listening?((0,s.uX)(),(0,s.CE)("div",st,[t[43]||(t[43]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-headphones"})],-1)),(0,s.Lk)("span",at,(0,G.v_)(o.getUserStatus(e.id).listening.trackName)+" by "+(0,G.v_)(o.getUserStatus(e.id).listening.artists),1)])):(0,s.Q3)("",!0)])])})),128))])])])]))])}var ot=r(8653),lt=r(4721);r(6280),r(6918),r(2008),r(113),r(8980),r(4423),r(4346),r(8598),r(2062),r(4782),r(6910),r(4554),r(9432),r(8940),r(8781),r(1699),r(7764),r(2762),r(2953),r(6031),r(8408),r(4603),r(7566),r(8721);const ct={name:"UserList",data:function(){return{utenti:[],userData:null,mostraModaleModifica:!1,utenteModificabile:{},filtri:{Username:"",Position:"",DateBorn:""},favorites:[],userId:null,statuses:[],showProfileCompletion:!1,profileData:{Position:"",DateBorn:"",Password:""},currentUserDetails:null,searchTerm:"",sortKey:"",sortAsc:!0,showFavoriteSelectionModal:!1,deezerSearchQuery:"",deezerSearchResults:[],selectedFavorites:[],isLoadingDeezer:!1,deezerSearchError:"",favoriteSelectionError:"",hasSearchedDeezer:!1,hasPreviouslySavedFavorites:!1,isSpotifyUser:!1,spotifyFavorites:[],isLoadingSpotifyFavorites:!1,spotifyFavoritesError:"",spotifyFavoritesLastUpdated:null}},computed:{processedUtenti:function(){var e=this,t=(0,lt.A)(this.utenti);if(this.filtri.Username&&(t=t.filter((function(t){return t.Username&&t.Username.toLowerCase().includes(e.filtri.Username.toLowerCase())}))),this.searchTerm){var r=this.searchTerm.toLowerCase();t=t.filter((function(e){return e.Username&&e.Username.toLowerCase().includes(r)||e.emailSpotify&&e.emailSpotify.toLowerCase().includes(r)||e.emailGoogle&&e.emailGoogle.toLowerCase().includes(r)||e.Position&&e.Position.toLowerCase().includes(r)}))}return this.sortKey&&t.sort((function(t,r){var n=t[e.sortKey],s=r[e.sortKey];return void 0!==n&&null!==n||(n=""),void 0!==s&&null!==s||(s=""),"string"===typeof n&&(n=n.toLowerCase()),"string"===typeof s&&(s=s.toLowerCase()),n<s?e.sortAsc?-1:1:n>s?e.sortAsc?1:-1:0})),t}},methods:{getUserData:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){var r;return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,f.A.get("/auth/me",{withCredentials:!0});case 3:if(r=t.sent,!r.data||!r.data.userId){t.next=22;break}return e.userData=r.data,e.userId=r.data.userId,e.isSpotifyUser=r.data.emailSpotify&&r.data.emailSpotify.length>0,t.next=10,e.fetchCurrentUserDetails(e.userId);case 10:if(!e.isSpotifyUser){t.next=13;break}return t.next=13,e.fetchAndSaveSpotifyFavorites();case 13:return t.next=15,e.checkRequiredFields();case 15:if(e.showProfileCompletion||e.showFavoriteSelectionModal){t.next=20;break}return t.next=18,e.recuperaUtenti();case 18:e.setupWebSocket(),e.isSpotifyUser&&e.setupSpotifyFavoritesPeriodic();case 20:t.next=23;break;case 22:e.$router.push("/");case 23:t.next=28;break;case 25:t.prev=25,t.t0=t["catch"](0),console.error("Error in getUserData:",t.t0);case 28:case"end":return t.stop()}}),t,null,[[0,25]])})))()},fetchAndSaveSpotifyFavorites:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){var r,n,s;return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isSpotifyUser){t.next=2;break}return t.abrupt("return");case 2:return e.isLoadingSpotifyFavorites=!0,e.spotifyFavoritesError="",t.prev=4,t.next=7,f.A.get("/favorites",{withCredentials:!0});case 7:if(r=t.sent,!r.data||!Array.isArray(r.data)){t.next=18;break}return n=r.data,s=n.map((function(e){var t;return{id:e.id,name:e.name,artist:e.artists.map((function(e){return e.name})).join(", "),albumName:e.album.name,imageUrl:e.album.images&&e.album.images[0]?e.album.images[0].url:null,link:(null===(t=e.external_urls)||void 0===t?void 0:t.spotify)||"",type:"track"}})),e.spotifyFavorites=s,e.selectedFavorites=(0,lt.A)(s),e.hasPreviouslySavedFavorites=!0,t.next=16,e.saveSpotifyFavoritesToDatabase(s);case 16:e.spotifyFavoritesLastUpdated=new Date,console.log("Spotify favorites updated:",e.spotifyFavorites);case 18:t.next=24;break;case 20:t.prev=20,t.t0=t["catch"](4),console.error("Error fetching Spotify favorites:",t.t0),e.spotifyFavoritesError="Failed to fetch your Spotify favorites. You may need to select favorites manually.";case 24:return t.prev=24,e.isLoadingSpotifyFavorites=!1,t.finish(24);case 27:case"end":return t.stop()}}),t,null,[[4,20,24,27]])})))()},saveSpotifyFavoritesToDatabase:function(e){var t=this;return(0,p.A)((0,d.A)().mark((function r(){return(0,d.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,f.A.post("/users/".concat(t.userId,"/set-favorites"),{favorites:e},{withCredentials:!0});case 3:console.log("Spotify favorites saved to database"),r.next=10;break;case 6:throw r.prev=6,r.t0=r["catch"](0),console.error("Error saving Spotify favorites to database:",r.t0),r.t0;case 10:case"end":return r.stop()}}),r,null,[[0,6]])})))()},setupSpotifyFavoritesPeriodic:function(){var e=this;this.spotifyCheckInterval=setInterval((function(){e.fetchAndSaveSpotifyFavorites()}),9e5)},checkRequiredSelections:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){var r,n;return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.currentUserDetails){t.next=6;break}if(!e.userId){t.next=4;break}return t.next=4,e.fetchCurrentUserDetails(e.userId);case 4:if(e.currentUserDetails){t.next=6;break}return t.abrupt("return");case 6:if(!(e.isSpotifyUser&&e.spotifyFavorites.length>0)){t.next=9;break}return e.showFavoriteSelectionModal=!1,t.abrupt("return");case 9:r=e.currentUserDetails.emailSpotify&&e.currentUserDetails.emailSpotify.length>0,n=e.currentUserDetails.favorite_selections&&Array.isArray(e.currentUserDetails.favorite_selections)&&e.currentUserDetails.favorite_selections.length>0,r||n?e.showFavoriteSelectionModal=!1:(e.showFavoriteSelectionModal=!0,e.deezerSearchQuery="",e.deezerSearchResults=[],e.deezerSearchError="",e.favoriteSelectionError="",e.hasSearchedDeezer=!1);case 12:case"end":return t.stop()}}),t)})))()},clearPeriodicChecks:function(){this.spotifyCheckInterval&&clearInterval(this.spotifyCheckInterval)},saveSelectedFavorites:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){var r;return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.favoriteSelectionError="",t.prev=1,t.next=4,f.A.post("/users/".concat(e.userId,"/set-favorites"),{favorites:e.selectedFavorites},{withCredentials:!0});case 4:return e.closeFavoriteSelectionModal(),t.next=7,e.fetchCurrentUserDetails(e.userId);case 7:if(e.showProfileCompletion||e.showFavoriteSelectionModal){t.next=10;break}return t.next=10,e.recuperaUtenti();case 10:t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](1),console.error("Error saving favorites:",t.t0),e.favoriteSelectionError=(null===(r=t.t0.response)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.message)||"Failed to save preferences.";case 16:case"end":return t.stop()}}),t,null,[[1,12]])})))()},fetchCurrentUserDetails:function(e){var t=this;return(0,p.A)((0,d.A)().mark((function r(){var n;return(0,d.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,f.A.get("/users/".concat(e),{withCredentials:!0});case 3:n=r.sent,t.currentUserDetails=n.data,t.currentUserDetails&&Array.isArray(t.currentUserDetails.favorite_selections)?(t.selectedFavorites=(0,lt.A)(t.currentUserDetails.favorite_selections),t.hasPreviouslySavedFavorites=t.selectedFavorites.length>0):(t.selectedFavorites=[],t.hasPreviouslySavedFavorites=!1),r.next=14;break;case 8:r.prev=8,r.t0=r["catch"](0),console.error("Error fetching current user details:",r.t0),t.currentUserDetails=null,t.selectedFavorites=[],t.hasPreviouslySavedFavorites=!1;case 14:case"end":return r.stop()}}),r,null,[[0,8]])})))()},checkRequiredFields:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e.currentUserDetails||!e.userId){t.next=4;break}return t.next=4,e.fetchCurrentUserDetails(e.userId);case 4:if(!e.currentUserDetails){t.next=18;break}if(e.currentUserDetails.Position&&e.currentUserDetails.DateBorn){t.next=11;break}e.profileData.Position=e.currentUserDetails.Position||"",e.profileData.DateBorn=e.currentUserDetails.DateBorn||"",e.showProfileCompletion=!0,t.next=18;break;case 11:return e.showProfileCompletion=!1,t.next=14,e.checkRequiredSelections();case 14:if(e.showFavoriteSelectionModal||e.showProfileCompletion){t.next=18;break}return t.next=17,e.recuperaUtenti();case 17:e.setupWebSocket();case 18:t.next=23;break;case 20:t.prev=20,t.t0=t["catch"](0),console.error("Errore nel controllo dei campi obbligatori:",t.t0);case 23:case"end":return t.stop()}}),t,null,[[0,20]])})))()},recuperaUtenti:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){var r;return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(t,r){var n=new XMLHttpRequest;n.open("GET","/users",!0),n.withCredentials=!0,n.setRequestHeader("userId",e.userId),n.onload=function(){n.status>=200&&n.status<300?t(JSON.parse(n.responseText)):r(new Error(n.statusText))},n.onerror=function(){r(new Error("Network Error"))},n.send()}));case 3:r=t.sent,console.log("Response:",r),e.utenti=r.filter((function(e){return!e.isAdmin})),e.utenti=e.utenti.filter((function(e){return!e.emailTwitch})),console.log("Users loaded:",e.utenti.length),t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](0),console.error("Errore nel recupero degli utenti:",t.t0),alert("Impossibile recuperare gli utenti.");case 14:case"end":return t.stop()}}),t,null,[[0,10]])})))()},openFavoriteSelectionModal:function(){if(this.currentUserDetails&&this.currentUserDetails.favorite_selections&&Array.isArray(this.currentUserDetails.favorite_selections)){var e=(0,lt.A)(this.currentUserDetails.favorite_selections);while(e.length<3)e.push("");this.currentFavorites=e.slice(0,3)}else this.currentFavorites=["","",""];this.favoriteSelectionError="",this.showFavoriteSelectionModal=!0},closeFavoriteSelectionModal:function(){this.showFavoriteSelectionModal=!1,this.deezerSearchError="",this.favoriteSelectionError=""},searchDeezer:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){var r,n;return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.deezerSearchQuery.trim()){t.next=3;break}return e.deezerSearchError="Please enter a search term.",t.abrupt("return");case 3:return e.isLoadingDeezer=!0,e.deezerSearchError="",e.deezerSearchResults=[],e.hasSearchedDeezer=!0,t.prev=7,t.next=10,f.A.get("/api/deezer/search",{params:{query:e.deezerSearchQuery,limit:10},withCredentials:!0});case 10:r=t.sent,e.deezerSearchResults=r.data,t.next=18;break;case 14:t.prev=14,t.t0=t["catch"](7),console.error("Error searching Deezer:",t.t0),e.deezerSearchError=(null===(n=t.t0.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.message)||"Failed to fetch music results from Deezer.";case 18:return t.prev=18,e.isLoadingDeezer=!1,t.finish(18);case 21:case"end":return t.stop()}}),t,null,[[7,14,18,21]])})))()},isSelectedFavorite:function(e){return this.selectedFavorites.some((function(t){return t.id===e.id}))},toggleFavoriteSelection:function(e){this.favoriteSelectionError="";var t=this.selectedFavorites.findIndex((function(t){return t.id===e.id}));t>-1?this.selectedFavorites.splice(t,1):this.selectedFavorites.length<3?this.selectedFavorites.push(e):this.favoriteSelectionError="You can select a maximum of 3 favorites."},removeSelectedFavorite:function(e){this.selectedFavorites=this.selectedFavorites.filter((function(t){return t.id!==e.id}))},completeProfile:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.profileData.Password=e.currentUserDetails.Password||"",t.next=4,f.A.put("/users/".concat(e.userId),(0,ot.A)((0,ot.A)({},e.currentUserDetails),{},{Position:e.profileData.Position,DateBorn:e.profileData.DateBorn,Password:e.profileData.Password}),{headers:{userId:e.userId},withCredentials:!0});case 4:return e.showProfileCompletion=!1,t.next=7,e.fetchCurrentUserDetails(e.userId);case 7:return t.next=9,e.checkRequiredSelections();case 9:if(e.showFavoriteSelectionModal||e.showProfileCompletion){t.next=13;break}return t.next=12,e.recuperaUtenti();case 12:e.setupWebSocket();case 13:t.next=19;break;case 15:t.prev=15,t.t0=t["catch"](0),console.error("Errore nell'aggiornamento del profilo:",t.t0),alert("Impossibile aggiornare il profilo. Riprova pi√π tardi.");case 19:case"end":return t.stop()}}),t,null,[[0,15]])})))()},pu√≤Modificare:function(e){var t;return e.id===(null===(t=this.userData)||void 0===t?void 0:t.userId)},pu√≤Cancellare:function(e){var t;return e.id===(null===(t=this.userData)||void 0===t?void 0:t.userId)},modificaUtente:function(e){this.pu√≤Modificare(e)?(this.utenteModificabile=(0,ot.A)({},e),this.mostraModaleModifica=!0):alert("Non hai i permessi per modificare questo utente.")},chiudiModale:function(){this.mostraModaleModifica=!1,this.utenteModificabile={}},aggiornaUtente:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,f.A.put("/users/".concat(e.utenteModificabile.id),{Username:e.utenteModificabile.Username,emailSpotify:e.utenteModificabile.emailSpotify,emailGoogle:e.utenteModificabile.emailGoogle,Position:e.utenteModificabile.Position,Password:e.utenteModificabile.Password,DateBorn:e.utenteModificabile.DateBorn},{headers:{userId:e.userId},withCredentials:!0});case 3:alert("Utente aggiornato con successo."),e.chiudiModale(),e.recuperaUtenti(),t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),console.error("Errore nell'aggiornamento dell'utente:",t.t0),t.t0.response&&t.t0.response.data&&t.t0.response.data.message?alert("Impossibile aggiornare l'utente: ".concat(t.t0.response.data.message)):alert("Impossibile aggiornare l'utente: ".concat(t.t0.message));case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()},cancellaUtente:function(e){var t=this;return(0,p.A)((0,d.A)().mark((function r(){return(0,d.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(confirm("Sei sicuro di voler eliminare il tuo account?")){r.next=2;break}return r.abrupt("return");case 2:return r.prev=2,r.next=5,f.A["delete"]("/users/".concat(e),{headers:{userId:t.userId},withCredentials:!0});case 5:e===parseInt(t.userId)?(alert("Il tuo account √® stato eliminato. Effettua il login di nuovo."),t.logout()):(alert('Utente con ID "'.concat(e,'" eliminato con successo.')),t.recuperaUtenti()),r.next=12;break;case 8:r.prev=8,r.t0=r["catch"](2),console.error("Errore nell'eliminazione dell'utente:",r.t0),r.t0.response&&r.t0.response.data&&r.t0.response.data.message?alert("Impossibile eliminare l'utente: ".concat(r.t0.response.data.message)):alert("Impossibile eliminare l'utente: ".concat(r.t0.message));case 12:case"end":return r.stop()}}),r,null,[[2,8]])})))()},logout:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,f.A.post("/logout",{},{withCredentials:!0});case 3:e.$router.push("/"),t.next=10;break;case 6:t.prev=6,t.t0=t["catch"](0),console.error("Logout error:",t.t0),alert("Errore durante il logout.");case 10:case"end":return t.stop()}}),t,null,[[0,6]])})))()},applicaFiltri:function(){var e=this,t=new XMLHttpRequest,r=new URLSearchParams;this.filtri.Position&&r.append("Position",this.filtri.Position),this.filtri.DateBorn&&r.append("DateBorn",this.filtri.DateBorn),t.open("GET","/users?".concat(r.toString()),!0),t.withCredentials=!0,t.setRequestHeader("userId",this.userId),t.onload=function(){t.status>=200&&t.status<300?e.utenti=JSON.parse(t.responseText).filter((function(e){return!e.isAdmin&&!e.emailTwitch})):(console.error("Error applying filters:",t.statusText),alert("Errore durante l'applicazione dei filtri."))},t.onerror=function(){console.error("Request failed"),alert("Errore di rete durante l'applicazione dei filtri.")},t.send()},resettaFiltri:function(){this.filtri.Position="",this.filtri.DateBorn="",this.filtri.Username="",this.searchTerm="",this.sortKey="",this.recuperaUtenti()},favorite:function(){var e=this;f.A.get("/favorites",{withCredentials:!0}).then((function(t){e.favorites=t.data}))["catch"]((function(e){console.error("Errore nel recupero dei brani preferiti:",e)}))},openSpotifyTrack:function(e){e&&e.external_urls&&e.external_urls.spotify?window.open(e.external_urls.spotify,"_blank"):alert("Link Spotify non disponibile per questo brano.")},getArtistNames:function(e){return e&&0!==e.length?e.map((function(e){return e.name})).join(", "):"Artista sconosciuto"},getUserStatus:function(e){var t=this.statuses.find((function(t){return t.userId==e}));return t||{}},setupWebSocket:function(){var e=this,t=new WebSocket("ws://localhost:3000");t.onopen=function(){console.log("WebSocket connection established.")},t.onmessage=function(t){var r=JSON.parse(t.data);"status_update"===r.type&&(e.statuses=r.data)},t.onclose=function(){console.log("WebSocket connection closed. Reconnecting in 5s..."),setTimeout((function(){return e.setupWebSocket()}),5e3)},t.onerror=function(e){console.error("WebSocket error:",e)},this.ws=t},sortBy:function(e){this.sortKey===e?this.sortAsc=!this.sortAsc:(this.sortKey=e,this.sortAsc=!0)}},mounted:function(){this.getUserData()},beforeUnmount:function(){this.clearPeriodicChecks()}},ut=(0,v.A)(ct,[["render",it],["__scopeId","data-v-0eca63be"]]),dt=ut;var pt={class:"auth-callback"};function ft(e,t,r,n,a,i){return(0,s.uX)(),(0,s.CE)("div",pt,t[0]||(t[0]=[(0,s.Lk)("p",null,"Autenticazione in corso...",-1)]))}const ht={name:"AuthCallback",mounted:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){var r;return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,f.A.get("/auth/me",{withCredentials:!0});case 3:if(r=t.sent,!r.data){t.next=8;break}r.data.isAdmin?e.$router.push("/admin"):e.$router.push("/users"),t.next=9;break;case 8:throw new Error("Authentication failed");case 9:t.next=16;break;case 11:t.prev=11,t.t0=t["catch"](0),console.error("Authentication error:",t.t0),alert("Authentication failed. Please try again."),e.$router.push("/");case 16:case"end":return t.stop()}}),t,null,[[0,11]])})))()}},vt=(0,v.A)(ht,[["render",ft],["__scopeId","data-v-03f735b2"]]),kt=vt;var mt={class:"admin-container"},gt={class:"admin-card"},Lt={class:"users-cards"},bt={class:"user-card-header"},yt={class:"user-actions"},wt=["onClick"],At=["onClick"],Ct={class:"user-card-content"},Ut={key:0,class:"modal"},St={class:"modal-content"},Dt={class:"modal-grid"},xt={class:"input-group"},Et={class:"input-group"},Ft={class:"input-group"},Pt={class:"input-group checkbox-group"},Mt={class:"modal-buttons"};function It(e,t,r,a,i,o){return(0,s.uX)(),(0,s.CE)("div",mt,[(0,s.Lk)("div",gt,[t[20]||(t[20]=(0,s.Lk)("div",{class:"header-section"},[(0,s.Lk)("h1",{class:"title"},"Admin Dashboard")],-1)),(0,s.Lk)("div",Lt,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.users,(function(e){return(0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"user-card"},[(0,s.Lk)("div",bt,[(0,s.Lk)("strong",null,(0,G.v_)(e.Username),1),(0,s.Lk)("div",yt,[(0,s.Lk)("button",{onClick:function(t){return o.editUser(e)},class:"action-button edit-button"}," Edit ",8,wt),(0,s.Lk)("button",{onClick:function(t){return o.deleteUser(e.id)},class:"action-button delete-button"}," Delete ",8,At)])]),(0,s.Lk)("div",Ct,[(0,s.Lk)("p",null,[t[7]||(t[7]=(0,s.Lk)("strong",null,"Email:",-1)),(0,s.eW)(" "+(0,G.v_)(e.Email),1)]),(0,s.Lk)("p",null,[t[8]||(t[8]=(0,s.Lk)("strong",null,"Email Spotify:",-1)),(0,s.eW)(" "+(0,G.v_)(e.emailSpotify),1)]),(0,s.Lk)("p",null,[t[9]||(t[9]=(0,s.Lk)("strong",null,"Email Twitch:",-1)),(0,s.eW)(" "+(0,G.v_)(e.emailTwitch),1)]),(0,s.Lk)("p",null,[t[10]||(t[10]=(0,s.Lk)("strong",null,"Email Google:",-1)),(0,s.eW)(" "+(0,G.v_)(e.emailGoogle),1)]),(0,s.Lk)("p",null,[t[11]||(t[11]=(0,s.Lk)("strong",null,"Position:",-1)),(0,s.eW)(" "+(0,G.v_)(e.Position),1)]),(0,s.Lk)("p",null,[t[12]||(t[12]=(0,s.Lk)("strong",null,"Date Born:",-1)),(0,s.eW)(" "+(0,G.v_)(o.formatDate(e.DateBorn)),1)]),(0,s.Lk)("p",null,[t[13]||(t[13]=(0,s.Lk)("strong",null,"Admin:",-1)),(0,s.eW)(" "+(0,G.v_)(e.isAdmin?"Yes":"No"),1)])])])})),128))]),i.showModal?((0,s.uX)(),(0,s.CE)("div",Ut,[(0,s.Lk)("div",St,[(0,s.Lk)("span",{class:"close",onClick:t[0]||(t[0]=function(){return o.closeModal&&o.closeModal.apply(o,arguments)})},"√ó"),t[19]||(t[19]=(0,s.Lk)("h2",null,"Edit User",-1)),(0,s.Lk)("form",{onSubmit:t[6]||(t[6]=(0,n.D$)((function(){return o.updateUser&&o.updateUser.apply(o,arguments)}),["prevent"]))},[(0,s.Lk)("div",Dt,[(0,s.Lk)("div",xt,[t[14]||(t[14]=(0,s.Lk)("label",null,"Username:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=function(e){return i.editingUser.Username=e}),type:"text",required:"",class:"cute-input"},null,512),[[n.Jo,i.editingUser.Username]])]),(0,s.Lk)("div",Et,[t[15]||(t[15]=(0,s.Lk)("label",null,"Position:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=function(e){return i.editingUser.Position=e}),type:"text",class:"cute-input"},null,512),[[n.Jo,i.editingUser.Position]])]),(0,s.Lk)("div",Ft,[t[16]||(t[16]=(0,s.Lk)("label",null,"Date Born:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=function(e){return i.editingUser.DateBorn=e}),type:"date",class:"cute-input"},null,512),[[n.Jo,i.editingUser.DateBorn]])]),(0,s.Lk)("div",Pt,[t[17]||(t[17]=(0,s.Lk)("label",null,"Is Admin:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=function(e){return i.editingUser.isAdmin=e}),type:"checkbox"},null,512),[[n.lH,i.editingUser.isAdmin]])])]),(0,s.Lk)("div",Mt,[t[18]||(t[18]=(0,s.Lk)("button",{type:"submit",class:"save-btn"},"Save",-1)),(0,s.Lk)("button",{type:"button",onClick:t[5]||(t[5]=function(){return o.closeModal&&o.closeModal.apply(o,arguments)}),class:"cancel-btn"}," Cancel ")])],32)])])):(0,s.Q3)("",!0)])])}const _t={name:"AdminPage",data:function(){return{users:[],showModal:!1,editingUser:{}}},created:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.loadUsers();case 2:case"end":return t.stop()}}),t)})))()},methods:{loadUsers:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){var r;return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,f.A.get("/users",{withCredentials:!0});case 3:r=t.sent,e.users=r.data,t.next=11;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("Error loading users:",t.t0),alert("Error loading users");case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()},editUser:function(e){this.editingUser=(0,ot.A)({},e),this.showModal=!0},closeModal:function(){this.showModal=!1,this.editingUser={}},updateUser:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,f.A.put("/users/".concat(e.editingUser.id),e.editingUser,{withCredentials:!0,headers:{isadmin:"true",userid:e.editingUser.id}});case 3:return t.next=5,e.loadUsers();case 5:e.closeModal(),t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),console.error("Error updating user:",t.t0),alert("Error updating user");case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()},deleteUser:function(e){var t=this;return(0,p.A)((0,d.A)().mark((function r(){return(0,d.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!confirm("Are you sure you want to delete this user?")){r.next=12;break}return r.prev=1,r.next=4,f.A["delete"]("/users/".concat(e),{withCredentials:!0,headers:{isadmin:"true",userid:e}});case 4:return r.next=6,t.loadUsers();case 6:r.next=12;break;case 8:r.prev=8,r.t0=r["catch"](1),console.error("Error deleting user:",r.t0),alert("Error deleting user");case 12:case"end":return r.stop()}}),r,null,[[1,8]])})))()},formatDate:function(e){var t={year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString(void 0,t)},logout:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,f.A.post("/logout",{},{withCredentials:!0});case 3:e.$router.push("/"),t.next=10;break;case 6:t.prev=6,t.t0=t["catch"](0),console.error("Logout error:",t.t0),alert("Error during logout.");case 10:case"end":return t.stop()}}),t,null,[[0,6]])})))()}}},Xt=(0,v.A)(_t,[["render",It],["__scopeId","data-v-5c04611c"]]),zt=Xt;var Bt={class:"profile-page"},Wt={class:"profile-navigation"},Tt={key:0,class:"loading-container"},Qt={key:1,class:"error-container"},Rt={key:2,class:"profile-content"},qt={key:0,class:"profile-card"},Ot={class:"avatar-container"},Nt={class:"avatar"},Jt={key:0,class:"settings-container"},Kt={key:0,class:"settings-dropdown",ref:"settingsMenu"},$t={class:"user-info"},Vt={class:"username"},Gt={class:"user-meta"},jt={class:"meta-item"},Ht={class:"meta-item"},Yt={key:1,class:"section-card compatibility-card"},Zt={class:"compatibility-content"},er={class:"compatibility-score"},tr={class:"match-level"},rr={class:"interests-section"},nr={class:"tags-container"},sr={class:"section-card"},ar={class:"tabs"},ir=["onClick"],or={key:0,class:"tab-content"},lr={class:"music-grid"},cr=["onClick"],ur={class:"music-cover"},dr=["src","alt"],pr={class:"music-info"},fr={class:"music-title"},hr={class:"music-artist"},vr={key:1,class:"tab-content"},kr={class:"music-grid"},mr={class:"music-cover"},gr=["src","alt"],Lr={class:"music-info"},br={class:"music-title"},yr={key:0,class:"empty-section"},wr={key:2,class:"tab-content"},Ar={class:"genres-grid"},Cr={class:"modal"},Ur={class:"modal-header"},Sr={class:"modal-body"},Dr={class:"input-group"},xr={class:"input-group"},Er={class:"input-group"},Fr={class:"modal-footer"},Pr={class:"modal"},Mr={class:"modal-header delete-header"},Ir={class:"modal-footer"};function _r(e,t,r,a,i,o){return(0,s.uX)(),(0,s.CE)("div",Bt,[(0,s.Lk)("div",Wt,[(0,s.Lk)("button",{class:"back-button",onClick:t[0]||(t[0]=function(){return o.goBack&&o.goBack.apply(o,arguments)})},t[16]||(t[16]=[(0,s.Lk)("span",{class:"back-icon"},"‚Üê",-1),(0,s.Lk)("span",null,"Torna indietro",-1)]))]),t[35]||(t[35]=(0,s.Lk)("div",{class:"profile-background"},null,-1)),i.loading?((0,s.uX)(),(0,s.CE)("div",Tt,t[17]||(t[17]=[(0,s.Lk)("div",{class:"pulse-loader"},null,-1),(0,s.Lk)("p",null,"Loading profile...",-1)]))):i.error?((0,s.uX)(),(0,s.CE)("div",Qt,[t[18]||(t[18]=(0,s.Lk)("div",{class:"error-icon"},"!",-1)),t[19]||(t[19]=(0,s.Lk)("h3",null,"Something went wrong",-1)),(0,s.Lk)("p",null,(0,G.v_)(i.error),1),(0,s.Lk)("button",{onClick:t[1]||(t[1]=function(){return o.fetchUserProfile&&o.fetchUserProfile.apply(o,arguments)}),class:"retry-button"},"Try Again")])):((0,s.uX)(),(0,s.CE)("div",Rt,[i.userData?((0,s.uX)(),(0,s.CE)("div",qt,[(0,s.Lk)("div",Ot,[(0,s.Lk)("div",Nt,(0,G.v_)(o.getUserInitials()),1)]),i.isOwnProfile?((0,s.uX)(),(0,s.CE)("div",Jt,[(0,s.Lk)("button",{class:"gear-button",onClick:t[2]||(t[2]=function(){return o.toggleSettingsMenu&&o.toggleSettingsMenu.apply(o,arguments)})},t[20]||(t[20]=[(0,s.Lk)("span",{class:"gear-icon"},"‚öôÔ∏è",-1)])),i.showSettingsMenu?((0,s.uX)(),(0,s.CE)("div",Kt,[(0,s.Lk)("div",{class:"dropdown-item",onClick:t[3]||(t[3]=function(){return o.openModifyModal&&o.openModifyModal.apply(o,arguments)})},t[21]||(t[21]=[(0,s.Lk)("span",{class:"dropdown-icon"},"‚úèÔ∏è",-1),(0,s.eW)(" Modifica Profilo ")])),(0,s.Lk)("div",{class:"dropdown-item delete-item",onClick:t[4]||(t[4]=function(){return o.openDeleteConfirmation&&o.openDeleteConfirmation.apply(o,arguments)})},t[22]||(t[22]=[(0,s.Lk)("span",{class:"dropdown-icon"},"üóëÔ∏è",-1),(0,s.eW)(" Elimina Account ")]))],512)):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",$t,[(0,s.Lk)("h2",Vt,(0,G.v_)(i.userData.Username),1),(0,s.Lk)("div",Gt,[(0,s.Lk)("span",jt,[t[23]||(t[23]=(0,s.Lk)("span",{class:"meta-icon"},"üìç",-1)),(0,s.eW)(" "+(0,G.v_)(i.userData.Position||"No Location"),1)]),(0,s.Lk)("span",Ht,[t[24]||(t[24]=(0,s.Lk)("span",{class:"meta-icon"},"üéÇ",-1)),(0,s.eW)(" "+(0,G.v_)(o.formatDate(i.userData.DateBorn)||"No Birthday"),1)])])])])):(0,s.Q3)("",!0),i.compatibility&&!i.isOwnProfile?((0,s.uX)(),(0,s.CE)("div",Yt,[t[26]||(t[26]=(0,s.Lk)("h2",{class:"section-title"},"Music Compatibility",-1)),(0,s.Lk)("div",Zt,[(0,s.Lk)("div",er,[(0,s.Lk)("div",{class:"score-circle",style:(0,G.Tr)(o.getScoreStyle(i.compatibility.score))},(0,G.v_)(i.compatibility.score)+"% ",5),(0,s.Lk)("p",tr,(0,G.v_)(i.compatibility.matchLevel),1)]),(0,s.Lk)("div",rr,[t[25]||(t[25]=(0,s.Lk)("h3",{class:"interests-title"},"Common Interests",-1)),(0,s.Lk)("div",nr,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.compatibility.commonArtists.slice(0,3),(function(e,t){return(0,s.uX)(),(0,s.CE)("div",{key:"artist-"+t,class:"interest-tag artist-tag"},(0,G.v_)(e),1)})),128)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.compatibility.commonGenres.slice(0,3),(function(e,t){return(0,s.uX)(),(0,s.CE)("div",{key:"genre-"+t,class:"interest-tag genre-tag"},(0,G.v_)(e),1)})),128))])])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",sr,[t[28]||(t[28]=(0,s.Lk)("h2",{class:"section-title"},"Music Tastes",-1)),(0,s.Lk)("div",ar,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(["tracks","artists","genres"],(function(e){return(0,s.Lk)("button",{key:e,class:(0,G.C4)(["tab-button",{active:i.activeTab===e}]),onClick:function(t){return i.activeTab=e}},(0,G.v_)(e.charAt(0).toUpperCase()+e.slice(1)),11,ir)})),64))]),"tracks"===i.activeTab?((0,s.uX)(),(0,s.CE)("div",or,[(0,s.Lk)("div",lr,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.favorites.tracks.slice(0,6),(function(e,t){return(0,s.uX)(),(0,s.CE)("div",{key:t,class:"music-card",onClick:function(t){return o.openMusicTrack(e)}},[(0,s.Lk)("div",ur,[(0,s.Lk)("img",{src:e.imageUrl||"https://via.placeholder.com/150",alt:e.name},null,8,dr)]),(0,s.Lk)("div",pr,[(0,s.Lk)("h3",fr,(0,G.v_)(e.name),1),(0,s.Lk)("p",hr,(0,G.v_)(e.artist),1)])],8,cr)})),128))])])):(0,s.Q3)("",!0),"artists"===i.activeTab?((0,s.uX)(),(0,s.CE)("div",vr,[(0,s.Lk)("div",kr,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.favorites.artists.slice(0,6),(function(e,t){return(0,s.uX)(),(0,s.CE)("div",{key:t,class:"music-card"},[(0,s.Lk)("div",mr,[(0,s.Lk)("img",{src:e.picture||"https://via.placeholder.com/150",alt:e.name},null,8,gr)]),(0,s.Lk)("div",Lr,[(0,s.Lk)("h3",br,(0,G.v_)(e.name),1)])])})),128))]),0===i.favorites.artists.length?((0,s.uX)(),(0,s.CE)("div",yr,t[27]||(t[27]=[(0,s.Lk)("p",null,"No artist data available",-1)]))):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),"genres"===i.activeTab?((0,s.uX)(),(0,s.CE)("div",wr,[(0,s.Lk)("div",Ar,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.favorites.genres.slice(0,10),(function(e,t){return(0,s.uX)(),(0,s.CE)("div",{key:t,class:"genre-bubble",style:(0,G.Tr)({backgroundImage:e.picture?"url(".concat(e.picture,")"):""})},(0,G.v_)(e.name),5)})),128))])])):(0,s.Q3)("",!0)])])),i.showModifyModal?((0,s.uX)(),(0,s.CE)("div",{key:3,class:"modal-overlay",onClick:t[11]||(t[11]=(0,n.D$)((function(){return o.closeModifyModal&&o.closeModifyModal.apply(o,arguments)}),["self"]))},[(0,s.Lk)("div",Cr,[(0,s.Lk)("div",Ur,[t[29]||(t[29]=(0,s.Lk)("h3",null,"Modifica Profilo",-1)),(0,s.Lk)("button",{onClick:t[5]||(t[5]=function(){return o.closeModifyModal&&o.closeModifyModal.apply(o,arguments)}),class:"close-btn"},"√ó")]),(0,s.Lk)("div",Sr,[(0,s.Lk)("div",Dr,[t[30]||(t[30]=(0,s.Lk)("label",{for:"modifyUsername"},"Username:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"modifyUsername","onUpdate:modelValue":t[6]||(t[6]=function(e){return i.modifyData.Username=e}),class:"form-input",placeholder:"Username"},null,512),[[n.Jo,i.modifyData.Username]])]),(0,s.Lk)("div",xr,[t[31]||(t[31]=(0,s.Lk)("label",{for:"modifyPosition"},"Posizione:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"modifyPosition","onUpdate:modelValue":t[7]||(t[7]=function(e){return i.modifyData.Position=e}),class:"form-input",placeholder:"es. Milano"},null,512),[[n.Jo,i.modifyData.Position]])]),(0,s.Lk)("div",Er,[t[32]||(t[32]=(0,s.Lk)("label",{for:"modifyDateBorn"},"Data di Nascita:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"modifyDateBorn",type:"date","onUpdate:modelValue":t[8]||(t[8]=function(e){return i.modifyData.DateBorn=e}),class:"form-input"},null,512),[[n.Jo,i.modifyData.DateBorn]])])]),(0,s.Lk)("div",Fr,[(0,s.Lk)("button",{onClick:t[9]||(t[9]=function(){return o.closeModifyModal&&o.closeModifyModal.apply(o,arguments)}),class:"cancel-btn"},"Annulla"),(0,s.Lk)("button",{onClick:t[10]||(t[10]=function(){return o.updateProfile&&o.updateProfile.apply(o,arguments)}),class:"primary-btn"},"Salva Modifiche")])])])):(0,s.Q3)("",!0),i.showDeleteConfirmation?((0,s.uX)(),(0,s.CE)("div",{key:4,class:"modal-overlay",onClick:t[15]||(t[15]=(0,n.D$)((function(){return o.closeDeleteConfirmation&&o.closeDeleteConfirmation.apply(o,arguments)}),["self"]))},[(0,s.Lk)("div",Pr,[(0,s.Lk)("div",Mr,[t[33]||(t[33]=(0,s.Lk)("h3",null,"Elimina Account",-1)),(0,s.Lk)("button",{onClick:t[12]||(t[12]=function(){return o.closeDeleteConfirmation&&o.closeDeleteConfirmation.apply(o,arguments)}),class:"close-btn"},"√ó")]),t[34]||(t[34]=(0,s.Lk)("div",{class:"modal-body"},[(0,s.Lk)("div",{class:"warning-message"},[(0,s.Lk)("p",null,[(0,s.Lk)("strong",null,"Attenzione!"),(0,s.eW)(" Questa azione non pu√≤ essere annullata.")]),(0,s.Lk)("p",null,"Sei sicuro di voler eliminare definitivamente il tuo account?")])],-1)),(0,s.Lk)("div",Ir,[(0,s.Lk)("button",{onClick:t[13]||(t[13]=function(){return o.closeDeleteConfirmation&&o.closeDeleteConfirmation.apply(o,arguments)}),class:"cancel-btn"},"Annulla"),(0,s.Lk)("button",{onClick:t[14]||(t[14]=function(){return o.deleteAccount&&o.deleteAccount.apply(o,arguments)}),class:"delete-btn"},"Elimina Account")])])])):(0,s.Q3)("",!0)])}r(8706),r(2892);const Xr={name:"ProfilePage",props:{userId:{type:[String,Number],required:!0}},data:function(){return{userData:null,loading:!0,error:null,favorites:{tracks:[],artists:[],genres:[]},activeTab:"tracks",userStatus:{online:!1,currentTrack:null},compatibility:null,previousUsers:[],currentUserId:null,isOwnProfile:!1,showSettingsMenu:!1,showModifyModal:!1,showDeleteConfirmation:!1,modifyData:{Username:"",Position:"",DateBorn:""}}},mounted:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.getCurrentUser();case 3:return t.next=5,e.fetchUserData(e.userId);case 5:e.isOwnProfile=e.currentUserId&&e.currentUserId.toString()===e.userId.toString(),document.addEventListener("click",e.handleOutsideClick),t.next=14;break;case 9:t.prev=9,t.t0=t["catch"](0),e.error="Failed to load user profile",e.loading=!1,console.error(t.t0);case 14:e.fetchUserProfile();case 15:case"end":return t.stop()}}),t,null,[[0,9]])})))()},beforeUnmount:function(){document.removeEventListener("click",this.handleOutsideClick)},methods:{getCurrentUser:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){var r;return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,f.A.get("/auth/me",{withCredentials:!0});case 3:r=t.sent,r.data&&r.data.userId&&(e.currentUserId=r.data.userId),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.log("Not logged in or error fetching current user");case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},toggleSettingsMenu:function(e){e.stopPropagation(),this.showSettingsMenu=!this.showSettingsMenu},handleOutsideClick:function(e){var t=this.$refs.settingsMenu,r=e.target.closest(".gear-button");this.showSettingsMenu&&t&&!t.contains(e.target)&&!r&&(this.showSettingsMenu=!1)},openModifyModal:function(){this.showSettingsMenu=!1,this.modifyData={Username:this.userData.Username||"",Position:this.userData.Position||"",DateBorn:this.userData.DateBorn||""},this.showModifyModal=!0},closeModifyModal:function(){this.showModifyModal=!1},openDeleteConfirmation:function(){this.showSettingsMenu=!1,this.showDeleteConfirmation=!0},closeDeleteConfirmation:function(){this.showDeleteConfirmation=!1},updateProfile:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,f.A.put("/users/".concat(e.userId),(0,ot.A)((0,ot.A)({},e.userData),{},{Username:e.modifyData.Username,Position:e.modifyData.Position,DateBorn:e.modifyData.DateBorn}),{headers:{userId:e.currentUserId},withCredentials:!0});case 3:return t.next=5,e.fetchUserData(e.userId);case 5:alert("Profilo aggiornato con successo"),e.closeModifyModal(),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](0),console.error("Error updating profile:",t.t0),alert("Errore durante l'aggiornamento del profilo. Riprova pi√π tardi.");case 13:case"end":return t.stop()}}),t,null,[[0,9]])})))()},deleteAccount:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,f.A["delete"]("/users/".concat(e.userId),{headers:{userId:e.currentUserId},withCredentials:!0});case 3:return t.next=5,f.A.post("/logout",{},{withCredentials:!0});case 5:e.$router.push("/"),t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),console.error("Error deleting account:",t.t0),alert("Errore durante l'eliminazione dell'account. Riprova pi√π tardi.");case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()},fetchUserProfile:function(){var e=this;return(0,p.A)((0,d.A)().mark((function t(){var r,n,s,a;return(0,d.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,e.error=null,t.prev=2,t.next=5,f.A.get("/users/".concat(e.userId),{withCredentials:!0});case 5:return r=t.sent,e.userData=r.data,t.next=9,f.A.get("/users/".concat(e.userId,"/favorites"),{withCredentials:!0});case 9:return n=t.sent,e.favorites=n.data,t.prev=11,t.next=14,f.A.get("/auth/me",{withCredentials:!0});case 14:if(s=t.sent,!s.data||s.data.userId===parseInt(e.userId)){t.next=20;break}return t.next=18,f.A.get("/users/compatibility/".concat(s.data.userId,"/").concat(e.userId),{withCredentials:!0});case 18:a=t.sent,e.compatibility=a.data;case 20:t.next=25;break;case 22:t.prev=22,t.t0=t["catch"](11),console.log("Not logged in or error fetching current user");case 25:t.next=31;break;case 27:t.prev=27,t.t1=t["catch"](2),console.error("Error fetching profile:",t.t1),e.error="Failed to load profile. Please try again.";case 31:return t.prev=31,e.loading=!1,t.finish(31);case 34:case"end":return t.stop()}}),t,null,[[2,27,31,34],[11,22]])})))()},fetchUserData:function(e){var t=this;return(0,p.A)((0,d.A)().mark((function r(){var n;return(0,d.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.loading=!0,r.prev=1,r.next=4,f.A.get("/users/".concat(e),{withCredentials:!0});case 4:n=r.sent,t.userData=n.data,t.loading=!1,r.next=14;break;case 9:throw r.prev=9,r.t0=r["catch"](1),t.error="Failed to load user data",t.loading=!1,r.t0;case 14:case"end":return r.stop()}}),r,null,[[1,9]])})))()},formatDate:function(e){if(!e)return"Unknown";var t={year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString(void 0,t)},openMusicTrack:function(e){console.log("Opening track:",e)},openSpotifyTrack:function(e){this.openMusicTrack(e)},getScoreStyle:function(e){var t;return t=e>=80?"#4CAF50":e>=60?"#2196F3":e>=40?"#FF9800":"#F44336",{background:"conic-gradient(".concat(t," ").concat(e,"%, #e0e0e0 0%)"),color:e>=60?"white":"#333"}},goBack:function(){this.$router.back()},getUserInitials:function(){return this.userData&&this.userData.Username?this.userData.Username.charAt(0).toUpperCase():"?"}},watch:{userId:{immediate:!0,handler:function(e,t){t&&t!==e&&this.previousUsers.push(t),e&&(this.fetchUserData(e),this.isOwnProfile=this.currentUserId&&this.currentUserId.toString()===e.toString())}}}},zr=(0,v.A)(Xr,[["render",_r],["__scopeId","data-v-ecef6b82"]]),Br=zr;var Wr=[{path:"/",name:"login",component:V},{path:"/register",name:"register",component:z},{path:"/users",name:"userlist",component:dt,meta:{requiresAuth:!0}},{path:"/auth/callback",name:"auth-callback",component:kt},{path:"/profile/:userId",name:"profile",component:Br,props:!0},{path:"/:pathMatch(.*)*",redirect:"/"},{path:"/admin",name:"admin",component:zt,meta:{requiresAuth:!0,requiresAdmin:!0}}],Tr=(0,g.aE)({history:(0,g.LA)("/"),routes:Wr});Tr.beforeEach(function(){var e=(0,p.A)((0,d.A)().mark((function e(t,r,n){var s,a,i,o,l,c,u;return(0,d.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=t.matched.some((function(e){return e.meta.requiresAuth})),a=t.matched.some((function(e){return e.meta.requiresAdmin})),i="login"===t.name||"register"===t.name,e.prev=3,e.next=6,f.A.get("/auth/check-session",{withCredentials:!0});case 6:l=e.sent,console.log("Auth check response:",l.data),c=l.data.authenticated,u=Boolean(null===(o=l.data.user)||void 0===o?void 0:o.isAdmin),console.log("isAuthenticated:",c,"isAdmin:",u),s&&!c?n({name:"login"}):a&&!u?n({name:"userlist"}):i&&c?n({name:u?"admin":"userlist"}):n(),e.next=18;break;case 14:e.prev=14,e.t0=e["catch"](3),console.error("Auth check error:",e.t0),s?n({name:"login"}):n();case 18:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t,r,n){return e.apply(this,arguments)}}());const Qr=Tr;(0,n.Ef)(m).use(Qr).mount("#app")}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}r.m=e,(()=>{var e=[];r.O=(t,n,s,a)=>{if(!n){var i=1/0;for(u=0;u<e.length;u++){for(var[n,s,a]=e[u],o=!0,l=0;l<n.length;l++)(!1&a||i>=a)&&Object.keys(r.O).every((e=>r.O[e](n[l])))?n.splice(l--,1):(o=!1,a<i&&(i=a));if(o){e.splice(u--,1);var c=s();void 0!==c&&(t=c)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,s,a]}})(),(()=>{r.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return r.d(t,{a:t}),t}})(),(()=>{r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}})(),(()=>{r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{r.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{var e={524:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var s,a,[i,o,l]=n,c=0;if(i.some((t=>0!==e[t]))){for(s in o)r.o(o,s)&&(r.m[s]=o[s]);if(l)var u=l(r)}for(t&&t(n);c<i.length;c++)a=i[c],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(u)},n=self["webpackChunksites"]=self["webpackChunksites"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var n=r.O(void 0,[504],(()=>r(6212)));n=r.O(n)})();
//# sourceMappingURL=app.4f57e7ec.js.map