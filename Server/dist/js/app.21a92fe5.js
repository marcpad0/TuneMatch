(function(){"use strict";var t={680:function(t,e,i){var o=i(5130),s=i(6768);const a={id:"app"},n={class:"nav-links"},l={class:"content"};function r(t,e){const i=(0,s.g2)("router-link"),o=(0,s.g2)("router-view");return(0,s.uX)(),(0,s.CE)("div",a,[(0,s.Lk)("nav",null,[(0,s.Lk)("ul",n,[(0,s.Lk)("li",null,[(0,s.bF)(i,{to:"/register"},{default:(0,s.k6)((()=>e[0]||(e[0]=[(0,s.eW)("Register")]))),_:1})]),(0,s.Lk)("li",null,[(0,s.bF)(i,{to:"/"},{default:(0,s.k6)((()=>e[1]||(e[1]=[(0,s.eW)("Login")]))),_:1})])])]),(0,s.Lk)("main",l,[(0,s.bF)(o)])])}var u=i(1241);const c={},d=(0,u.A)(c,[["render",r]]);var p=d,h=(i(8111),i(3579),i(1387)),g=i.p+"img/spotify-logo.e5c8776a.png",m=i.p+"img/google-logo.963bc2a0.png";const k={class:"login-container"},f={class:"login-card"},L={class:"input-group"},b={class:"input-group"},v={class:"input-group"},y={class:"input-group"},w={class:"input-group"},U={class:"social-logins"},C={class:"spotify-login"},E={class:"google-login"},S={class:"register-link"};function D(t,e,i,a,n,l){const r=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",k,[(0,s.Lk)("div",f,[e[18]||(e[18]=(0,s.Lk)("h2",{class:"title"},"Registrati",-1)),(0,s.Lk)("form",{onSubmit:e[5]||(e[5]=(0,o.D$)(((...t)=>l.registerUser&&l.registerUser(...t)),["prevent"]))},[(0,s.Lk)("div",L,[e[8]||(e[8]=(0,s.Lk)("label",{for:"username"},"Username",-1)),(0,s.bo)((0,s.Lk)("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=t=>n.username=t),type:"text",placeholder:"Inserisci il tuo username",required:""},null,512),[[o.Jo,n.username]])]),(0,s.Lk)("div",b,[e[9]||(e[9]=(0,s.Lk)("label",{for:"emailSpotify"},"Email Spotify",-1)),(0,s.bo)((0,s.Lk)("input",{id:"emailSpotify","onUpdate:modelValue":e[1]||(e[1]=t=>n.emailSpotify=t),type:"email",placeholder:"Inserisci la tua email di Spotify",required:""},null,512),[[o.Jo,n.emailSpotify]])]),(0,s.Lk)("div",v,[e[10]||(e[10]=(0,s.Lk)("label",{for:"position"},"Posizione",-1)),(0,s.bo)((0,s.Lk)("input",{id:"position","onUpdate:modelValue":e[2]||(e[2]=t=>n.position=t),type:"text",placeholder:"Inserisci la tua posizione",required:""},null,512),[[o.Jo,n.position]])]),(0,s.Lk)("div",y,[e[11]||(e[11]=(0,s.Lk)("label",{for:"dateBorn"},"Data di Nascita",-1)),(0,s.bo)((0,s.Lk)("input",{id:"dateBorn","onUpdate:modelValue":e[3]||(e[3]=t=>n.dateBorn=t),type:"date",required:""},null,512),[[o.Jo,n.dateBorn]])]),(0,s.Lk)("div",w,[e[12]||(e[12]=(0,s.Lk)("label",{for:"password"},"Password",-1)),(0,s.bo)((0,s.Lk)("input",{id:"password","onUpdate:modelValue":e[4]||(e[4]=t=>n.password=t),type:"password",placeholder:"Inserisci la tua password",required:""},null,512),[[o.Jo,n.password]])]),e[13]||(e[13]=(0,s.Lk)("button",{type:"submit",class:"login-button"},"Registrati",-1))],32),(0,s.Lk)("div",U,[(0,s.Lk)("div",C,[(0,s.Lk)("button",{onClick:e[6]||(e[6]=(...t)=>l.loginWithSpotify&&l.loginWithSpotify(...t)),class:"spotify-button"},e[14]||(e[14]=[(0,s.Lk)("img",{src:g,alt:"Spotify Logo"},null,-1),(0,s.eW)(" Accedi con Spotify ")]))]),(0,s.Lk)("div",E,[(0,s.Lk)("button",{onClick:e[7]||(e[7]=(...t)=>l.loginWithGoogle&&l.loginWithGoogle(...t)),class:"google-button"},e[15]||(e[15]=[(0,s.Lk)("img",{src:m,alt:"Google Logo"},null,-1),(0,s.eW)(" Accedi con Google ")]))])]),(0,s.Lk)("p",S,[e[17]||(e[17]=(0,s.eW)(" Hai già un account? ")),(0,s.bF)(r,{to:"/login"},{default:(0,s.k6)((()=>e[16]||(e[16]=[(0,s.eW)("Accedi")]))),_:1})])])])}i(4114);var P=i(4373),A={name:"tofo-item",data(){return{username:"",emailSpotify:"",position:"",password:"",dateBorn:""}},methods:{async registerUser(){try{const t=await P.A.post("/users",{Username:this.username,emailSpotify:this.emailSpotify,Position:this.position,Password:this.password,DateBorn:this.dateBorn});alert(`Utente registrato con successo con ID: ${t.data.message}`),this.$router.push("/")}catch(t){console.error("Errore durante la registrazione:",t),t.response&&409===t.response.status?alert("Registrazione fallita: Nome utente già in uso."):t.response&&t.response.data&&t.response.data.message?alert(`Registrazione fallita: ${t.response.data.message}`):alert("Registrazione fallita. Riprova più tardi.")}},loginWithSpotify(){window.location.href="/auth/spotify"},loginWithTwitch(){window.location.href="/auth/Twitch"},loginWithGoogle(){window.location.href="/auth/google"}}};const M=(0,u.A)(A,[["render",D],["__scopeId","data-v-11819aab"]]);var I=M;const _={class:"login-container"},W={class:"login-card"},B={class:"input-group"},X={class:"input-group"},$={class:"spotify-login"},F={class:"google-login"},q={class:"register-link"};function G(t,e,i,a,n,l){const r=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",_,[(0,s.Lk)("div",W,[e[12]||(e[12]=(0,s.Lk)("h2",{class:"title"},"Accedi",-1)),(0,s.Lk)("form",{onSubmit:e[2]||(e[2]=(0,o.D$)(((...t)=>l.loginUser&&l.loginUser(...t)),["prevent"]))},[(0,s.Lk)("div",B,[e[5]||(e[5]=(0,s.Lk)("label",{for:"username"},"Username",-1)),(0,s.bo)((0,s.Lk)("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=t=>n.username=t),type:"text",placeholder:"Inserisci il tuo username",required:""},null,512),[[o.Jo,n.username]])]),(0,s.Lk)("div",X,[e[6]||(e[6]=(0,s.Lk)("label",{for:"password"},"Password",-1)),(0,s.bo)((0,s.Lk)("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=t=>n.password=t),type:"password",placeholder:"Inserisci la tua password",required:""},null,512),[[o.Jo,n.password]])]),e[7]||(e[7]=(0,s.Lk)("button",{type:"submit",class:"login-button"},"Login",-1))],32),(0,s.Lk)("div",$,[(0,s.Lk)("button",{onClick:e[3]||(e[3]=(...t)=>l.loginWithSpotify&&l.loginWithSpotify(...t)),class:"spotify-button"},e[8]||(e[8]=[(0,s.Lk)("img",{src:g,alt:"Spotify Logo"},null,-1),(0,s.eW)(" Accedi con Spotify ")]))]),(0,s.Lk)("div",F,[(0,s.Lk)("button",{onClick:e[4]||(e[4]=(...t)=>l.loginWithGoogle&&l.loginWithGoogle(...t)),class:"google-button"},e[9]||(e[9]=[(0,s.Lk)("img",{src:m,alt:"Google Logo"},null,-1),(0,s.eW)(" Accedi con Google ")]))]),(0,s.Lk)("p",q,[e[11]||(e[11]=(0,s.eW)(" Non hai un account? ")),(0,s.bF)(r,{to:"/register"},{default:(0,s.k6)((()=>e[10]||(e[10]=[(0,s.eW)("Registrati")]))),_:1})])])])}var J={name:"todo-item",data(){return{username:"",password:""}},methods:{async loginUser(){try{await P.A.post("/login",{Username:this.username,Password:this.password},{withCredentials:!0});const t=await P.A.get("/auth/me",{withCredentials:!0});t.data&&t.data.isAdmin?this.$router.push("/admin"):this.$router.push("/users")}catch(t){console.error(t),t.response?.data?.message?alert(`Login fallito: ${t.response.data.message}`):alert(`Login fallito: ${t.message}`)}},loginWithSpotify(){window.location.href="/login/spotify"},loginWithTwitch(){window.location.href="/login/twitch"},loginWithGoogle(){window.location.href="/login/google"}}};const x=(0,u.A)(J,[["render",G],["__scopeId","data-v-7f889c28"]]);var V=x,O=i(4232);const R={class:"userlist-container"},T={key:0,class:"modal profile-completion-modal"},N={class:"modal-content"},z={class:"modal-grid"},Q={class:"input-group"},j={class:"input-group"},H={key:1,class:"userlist-card"},K={class:"header-section"},Y={class:"filters"},Z={class:"filters-grid"},tt={class:"input-group"},et={class:"input-group"},it={class:"filter-buttons"},ot={class:"user-cards-mobile"},st={class:"user-card-header"},at={class:"user-actions"},nt=["onClick"],lt=["onClick"],rt={class:"user-card-content"},ut={class:"status-line"},ct={key:0,class:"status-indicator online"},dt={key:1,class:"status-indicator offline"},pt={key:2},ht={key:3},gt={key:0,class:"listening-container"},mt={class:"listening-text"},kt={key:1,style:{"min-height":"20px"}},ft={class:"table-responsive desktop-only"},Lt={class:"user-table"},bt={class:"status-line"},vt={key:0,class:"status-indicator online"},yt={key:1,class:"status-indicator offline"},wt={key:2},Ut={key:3},Ct={key:0,class:"listening-container"},Et={class:"listening-text"},St=["onClick"],Dt=["onClick"],Pt={class:"favorite-tracks-section"},At={class:"favorites-grid"},Mt=["onClick"],It=["src"],_t={class:"track-info"},Wt={key:0,class:"modal"},Bt={class:"modal-content"},Xt={class:"modal-grid"},$t={class:"input-group"},Ft={class:"input-group"},qt={class:"input-group"},Gt={class:"input-group"},Jt={class:"input-group"},xt={class:"input-group"};function Vt(t,e,i,a,n,l){return(0,s.uX)(),(0,s.CE)("div",R,[n.showProfileCompletion?((0,s.uX)(),(0,s.CE)("div",T,[(0,s.Lk)("div",N,[e[19]||(e[19]=(0,s.Lk)("h3",{class:"modal-title"},"Completa il tuo profilo",-1)),e[20]||(e[20]=(0,s.Lk)("p",null,"Per continuare, completa i seguenti dati obbligatori:",-1)),(0,s.Lk)("form",{onSubmit:e[2]||(e[2]=(0,o.D$)(((...t)=>l.completeProfile&&l.completeProfile(...t)),["prevent"]))},[(0,s.Lk)("div",z,[(0,s.Lk)("div",Q,[e[16]||(e[16]=(0,s.Lk)("label",{for:"completePosition"},"Posizione:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"completePosition","onUpdate:modelValue":e[0]||(e[0]=t=>n.profileData.Position=t),required:"",class:"cute-input",placeholder:"es. Milano"},null,512),[[o.Jo,n.profileData.Position]])]),(0,s.Lk)("div",j,[e[17]||(e[17]=(0,s.Lk)("label",{for:"completeDateBorn"},"Data di Nascita:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"completeDateBorn",type:"date","onUpdate:modelValue":e[1]||(e[1]=t=>n.profileData.DateBorn=t),required:"",class:"cute-input"},null,512),[[o.Jo,n.profileData.DateBorn]])])]),e[18]||(e[18]=(0,s.Lk)("button",{type:"submit",class:"modal-button"},"Salva e Continua",-1))],32)])])):(0,s.Q3)("",!0),n.showProfileCompletion?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",H,[(0,s.Lk)("div",K,[e[21]||(e[21]=(0,s.Lk)("h2",{class:"title"},"Lista Utenti",-1)),(0,s.Lk)("button",{class:"filter-button",onClick:e[3]||(e[3]=(...t)=>l.logout&&l.logout(...t))},"Logout")]),(0,s.Lk)("div",Y,[e[25]||(e[25]=(0,s.Lk)("h3",{class:"subtitle"},"Filtra Utenti",-1)),(0,s.Lk)("form",{onSubmit:e[7]||(e[7]=(0,o.D$)(((...t)=>l.applicaFiltri&&l.applicaFiltri(...t)),["prevent"]))},[(0,s.Lk)("div",Z,[(0,s.Lk)("div",tt,[e[22]||(e[22]=(0,s.Lk)("label",{for:"position"},"Posizione:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"position","onUpdate:modelValue":e[4]||(e[4]=t=>n.filtri.Position=t),placeholder:"es. Bergamo",class:"cute-input"},null,512),[[o.Jo,n.filtri.Position]])]),(0,s.Lk)("div",et,[e[23]||(e[23]=(0,s.Lk)("label",{for:"dateBorn"},"Data di Nascita:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date",id:"dateBorn","onUpdate:modelValue":e[5]||(e[5]=t=>n.filtri.DateBorn=t),class:"cute-input"},null,512),[[o.Jo,n.filtri.DateBorn]])])]),(0,s.Lk)("div",it,[e[24]||(e[24]=(0,s.Lk)("button",{type:"submit",class:"filter-button"},"Applica Filtri",-1)),(0,s.Lk)("button",{type:"button",class:"filter-button",onClick:e[6]||(e[6]=(...t)=>l.resettaFiltri&&l.resettaFiltri(...t))}," Reset Filtri ")])],32)]),(0,s.Lk)("div",ot,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.utentiFiltrati,(t=>((0,s.uX)(),(0,s.CE)("div",{key:t.id,class:"user-card"},[(0,s.Lk)("div",st,[(0,s.Lk)("strong",null,(0,O.v_)(t.Username),1),(0,s.Lk)("div",at,[l.puòModificare(t)?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"action-button",onClick:e=>l.modificaUtente(t)}," Modifica ",8,nt)):(0,s.Q3)("",!0),l.puòCancellare(t)?((0,s.uX)(),(0,s.CE)("button",{key:1,class:"action-button delete-button",onClick:e=>l.cancellaUtente(t.id)}," Cancella ",8,lt)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",rt,[(0,s.Lk)("p",null,[e[26]||(e[26]=(0,s.Lk)("strong",null,"Email Spotify:",-1)),(0,s.eW)(" "+(0,O.v_)(t.emailSpotify),1)]),(0,s.Lk)("p",null,[e[27]||(e[27]=(0,s.Lk)("strong",null,"Email Google:",-1)),(0,s.eW)(" "+(0,O.v_)(t.emailGoogle),1)]),(0,s.Lk)("p",null,[e[28]||(e[28]=(0,s.Lk)("strong",null,"Posizione:",-1)),(0,s.eW)(" "+(0,O.v_)(t.Position),1)]),(0,s.Lk)("p",null,[e[29]||(e[29]=(0,s.Lk)("strong",null,"Data di Nascita:",-1)),(0,s.eW)(" "+(0,O.v_)(t.DateBorn),1)]),(0,s.Lk)("p",ut,[e[30]||(e[30]=(0,s.Lk)("strong",null,"Status:",-1)),l.getUserStatus(t.id).online?((0,s.uX)(),(0,s.CE)("span",ct)):((0,s.uX)(),(0,s.CE)("span",dt)),l.getUserStatus(t.id).online?((0,s.uX)(),(0,s.CE)("span",pt,"Online")):((0,s.uX)(),(0,s.CE)("span",ht,"Offline"))]),l.getUserStatus(t.id).listening?((0,s.uX)(),(0,s.CE)("div",gt,[e[31]||(e[31]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-headphones"}),(0,s.eW)(" Listening to:")],-1)),(0,s.Lk)("span",mt,(0,O.v_)(l.getUserStatus(t.id).listening.trackName)+" by "+(0,O.v_)(l.getUserStatus(t.id).listening.artists),1)])):((0,s.uX)(),(0,s.CE)("div",kt))])])))),128))]),(0,s.Lk)("div",ft,[(0,s.Lk)("table",Lt,[e[33]||(e[33]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Username"),(0,s.Lk)("th",null,"Email Spotify"),(0,s.Lk)("th",null,"Email Google"),(0,s.Lk)("th",null,"Posizione"),(0,s.Lk)("th",null,"Data di Nascita"),(0,s.Lk)("th",null,"Status"),(0,s.Lk)("th",null,"Listening"),(0,s.Lk)("th",null,"Azioni")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.utentiFiltrati,(t=>((0,s.uX)(),(0,s.CE)("tr",{key:t.id},[(0,s.Lk)("td",null,(0,O.v_)(t.Username),1),(0,s.Lk)("td",null,(0,O.v_)(t.emailSpotify),1),(0,s.Lk)("td",null,(0,O.v_)(t.emailGoogle),1),(0,s.Lk)("td",null,(0,O.v_)(t.Position),1),(0,s.Lk)("td",null,(0,O.v_)(t.DateBorn),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",bt,[l.getUserStatus(t.id).online?((0,s.uX)(),(0,s.CE)("span",vt)):((0,s.uX)(),(0,s.CE)("span",yt)),l.getUserStatus(t.id).online?((0,s.uX)(),(0,s.CE)("span",wt,"Online")):((0,s.uX)(),(0,s.CE)("span",Ut,"Offline"))])]),(0,s.Lk)("td",null,[l.getUserStatus(t.id).listening?((0,s.uX)(),(0,s.CE)("div",Ct,[e[32]||(e[32]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-headphones"})],-1)),(0,s.Lk)("span",Et,(0,O.v_)(l.getUserStatus(t.id).listening.trackName)+" by "+(0,O.v_)(l.getUserStatus(t.id).listening.artists),1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("td",null,[l.puòModificare(t)?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"action-button",onClick:e=>l.modificaUtente(t)}," Modifica ",8,St)):(0,s.Q3)("",!0),l.puòCancellare(t)?((0,s.uX)(),(0,s.CE)("button",{key:1,class:"action-button delete-button",onClick:e=>l.cancellaUtente(t.id)}," Cancella ",8,Dt)):(0,s.Q3)("",!0)])])))),128))])])]),(0,s.Lk)("div",Pt,[e[36]||(e[36]=(0,s.Lk)("h3",{class:"subtitle"},"Brani Preferiti",-1)),(0,s.Lk)("div",At,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.favorites,(t=>((0,s.uX)(),(0,s.CE)("div",{key:t.id,class:"favorite-track-card",onClick:e=>l.openSpotifyTrack(t)},[t.album&&t.album.images&&t.album.images[0]?((0,s.uX)(),(0,s.CE)("img",{key:0,src:t.album.images[0].url,alt:"Album Art",class:"album-art"},null,8,It)):(0,s.Q3)("",!0),(0,s.Lk)("div",_t,[(0,s.Lk)("h4",null,(0,O.v_)(t.name),1),(0,s.Lk)("p",null,[e[34]||(e[34]=(0,s.Lk)("strong",null,"Artista:",-1)),(0,s.eW)(" "+(0,O.v_)(l.getArtistNames(t.artists)),1)]),(0,s.Lk)("p",null,[e[35]||(e[35]=(0,s.Lk)("strong",null,"Album:",-1)),(0,s.eW)(" "+(0,O.v_)(t.album.name),1)])])],8,Mt)))),128))])]),n.mostraModaleModifica?((0,s.uX)(),(0,s.CE)("div",Wt,[(0,s.Lk)("div",Bt,[(0,s.Lk)("span",{class:"close",onClick:e[8]||(e[8]=(...t)=>l.chiudiModale&&l.chiudiModale(...t))},"×"),e[44]||(e[44]=(0,s.Lk)("h3",{class:"modal-title"},"Modifica Utente",-1)),(0,s.Lk)("form",{onSubmit:e[15]||(e[15]=(0,o.D$)(((...t)=>l.aggiornaUtente&&l.aggiornaUtente(...t)),["prevent"]))},[(0,s.Lk)("div",Xt,[(0,s.Lk)("div",$t,[e[37]||(e[37]=(0,s.Lk)("label",{for:"editUsername"},"Username:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"editUsername","onUpdate:modelValue":e[9]||(e[9]=t=>n.utenteModificabile.Username=t),required:"",class:"cute-input"},null,512),[[o.Jo,n.utenteModificabile.Username]])]),(0,s.Lk)("div",Ft,[e[38]||(e[38]=(0,s.Lk)("label",{for:"editEmailSpotify"},"Email Spotify:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"editEmailSpotify","onUpdate:modelValue":e[10]||(e[10]=t=>n.utenteModificabile.emailSpotify=t),class:"cute-input"},null,512),[[o.Jo,n.utenteModificabile.emailSpotify]])]),(0,s.Lk)("div",qt,[e[39]||(e[39]=(0,s.Lk)("label",{for:"editEmailGoogle"},"Email Google:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"editEmailGoogle","onUpdate:modelValue":e[11]||(e[11]=t=>n.utenteModificabile.emailGoogle=t),class:"cute-input"},null,512),[[o.Jo,n.utenteModificabile.emailGoogle]])]),(0,s.Lk)("div",Gt,[e[40]||(e[40]=(0,s.Lk)("label",{for:"editPosition"},"Posizione:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"editPosition","onUpdate:modelValue":e[12]||(e[12]=t=>n.utenteModificabile.Position=t),class:"cute-input"},null,512),[[o.Jo,n.utenteModificabile.Position]])]),(0,s.Lk)("div",Jt,[e[41]||(e[41]=(0,s.Lk)("label",{for:"editPassword"},"Password:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"editPassword",type:"password","onUpdate:modelValue":e[13]||(e[13]=t=>n.utenteModificabile.Password=t),required:"",class:"cute-input"},null,512),[[o.Jo,n.utenteModificabile.Password]])]),(0,s.Lk)("div",xt,[e[42]||(e[42]=(0,s.Lk)("label",{for:"editDateBorn"},"Data di Nascita:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"editDateBorn",type:"date","onUpdate:modelValue":e[14]||(e[14]=t=>n.utenteModificabile.DateBorn=t),class:"cute-input"},null,512),[[o.Jo,n.utenteModificabile.DateBorn]])])]),e[43]||(e[43]=(0,s.Lk)("button",{type:"submit",class:"modal-button"},"Salva Modifiche",-1))],32)])])):(0,s.Q3)("",!0)]))])}i(2489),i(116),i(1701),i(4603),i(7566),i(8721);var Ot={name:"UserList",data(){return{utenti:[],utentiFiltrati:[],userData:null,mostraModaleModifica:!1,utenteModificabile:{},filtri:{Position:"",DateBorn:""},favorites:[],userId:null,statuses:[],showProfileCompletion:!1,profileData:{Position:"",DateBorn:"",Password:""},currentUserDetails:null}},methods:{async getUserData(){try{const t=await P.A.get("/auth/me",{withCredentials:!0});this.userData=t.data,this.userId=this.userData.userId.toString(),await this.checkRequiredFields()}catch(t){console.error("Errore nel recupero dei dati utente:",t),this.$router.push("/")}},async checkRequiredFields(){try{const t=await this.getUserById(this.userId);t&&t.length>0&&(this.currentUserDetails=t[0],this.currentUserDetails.Position&&this.currentUserDetails.DateBorn?(await this.recuperaUtenti(),this.favorite(),this.setupWebSocket()):(this.profileData.Position=this.currentUserDetails.Position||"",this.profileData.DateBorn=this.currentUserDetails.DateBorn||"",this.showProfileCompletion=!0))}catch(t){console.error("Errore nel controllo dei campi obbligatori:",t)}},async getUserById(t){try{const e=await P.A.get(`/users?id=${t}`,{headers:{userId:this.userId},withCredentials:!0});return e.data}catch(e){return console.error("Errore nel recupero dettagli utente:",e),null}},async completeProfile(){try{this.profileData.Password=this.currentUserDetails.Password||"",await P.A.put(`/users/${this.userId}`,{...this.currentUserDetails,Position:this.profileData.Position,DateBorn:this.profileData.DateBorn,Password:this.profileData.Password},{headers:{userId:this.userId},withCredentials:!0}),this.showProfileCompletion=!1,await this.recuperaUtenti(),this.favorite(),this.setupWebSocket()}catch(t){console.error("Errore nell'aggiornamento del profilo:",t),alert("Impossibile aggiornare il profilo. Riprova più tardi.")}},async recuperaUtenti(){try{const t=await new Promise(((t,e)=>{const i=new XMLHttpRequest;i.open("GET","/users",!0),i.withCredentials=!0,i.setRequestHeader("userId",this.userId),i.onload=function(){i.status>=200&&i.status<300?t(JSON.parse(i.responseText)):e(new Error(i.statusText))},i.onerror=function(){e(new Error("Network Error"))},i.send()}));this.utenti=t.filter((t=>!t.isAdmin)),this.utenti=this.utenti.filter((t=>!t.emailTwitch)),this.utentiFiltrati=this.utenti,console.log("Users loaded:",this.utenti.length)}catch(t){console.error("Errore nel recupero degli utenti:",t),alert("Impossibile recuperare gli utenti.")}},"puòModificare"(t){return t.id===this.userData?.userId},"puòCancellare"(t){return t.id===this.userData?.userId},modificaUtente(t){this.puòModificare(t)?(this.utenteModificabile={...t},this.mostraModaleModifica=!0):alert("Non hai i permessi per modificare questo utente.")},chiudiModale(){this.mostraModaleModifica=!1,this.utenteModificabile={}},async aggiornaUtente(){try{await P.A.put(`/users/${this.utenteModificabile.id}`,{Username:this.utenteModificabile.Username,emailSpotify:this.utenteModificabile.emailSpotify,emailGoogle:this.utenteModificabile.emailGoogle,Position:this.utenteModificabile.Position,Password:this.utenteModificabile.Password,DateBorn:this.utenteModificabile.DateBorn},{headers:{userId:this.userId},withCredentials:!0}),alert("Utente aggiornato con successo."),this.chiudiModale(),this.recuperaUtenti()}catch(t){console.error("Errore nell'aggiornamento dell'utente:",t),t.response&&t.response.data&&t.response.data.message?alert(`Impossibile aggiornare l'utente: ${t.response.data.message}`):alert(`Impossibile aggiornare l'utente: ${t.message}`)}},async cancellaUtente(t){if(confirm("Sei sicuro di voler eliminare il tuo account?"))try{await P.A.delete(`/users/${t}`,{headers:{userId:this.userId},withCredentials:!0}),t===parseInt(this.userId)?(alert("Il tuo account è stato eliminato. Effettua il login di nuovo."),this.logout()):(alert(`Utente con ID "${t}" eliminato con successo.`),this.recuperaUtenti())}catch(e){console.error("Errore nell'eliminazione dell'utente:",e),e.response&&e.response.data&&e.response.data.message?alert(`Impossibile eliminare l'utente: ${e.response.data.message}`):alert(`Impossibile eliminare l'utente: ${e.message}`)}},async logout(){try{await P.A.post("/logout",{},{withCredentials:!0}),this.$router.push("/")}catch(t){console.error("Logout error:",t),alert("Errore durante il logout.")}},applicaFiltri(){const t=new XMLHttpRequest,e=new URLSearchParams;this.filtri.Position&&e.append("Position",this.filtri.Position),this.filtri.DateBorn&&e.append("DateBorn",this.filtri.DateBorn),t.open("GET",`/users?${e.toString()}`,!0),t.withCredentials=!0,t.setRequestHeader("userId",this.userId),t.onload=()=>{t.status>=200&&t.status<300?this.utentiFiltrati=JSON.parse(t.responseText).filter((t=>!t.isAdmin)):(console.error("Error applying filters:",t.statusText),alert("Errore durante l'applicazione dei filtri."))},t.onerror=()=>{console.error("Request failed"),alert("Errore di rete durante l'applicazione dei filtri.")},t.send()},resettaFiltri(){this.filtri.Position="",this.filtri.DateBorn="",this.utentiFiltrati=this.utenti},favorite(){P.A.get("/favorites",{withCredentials:!0}).then((t=>{this.favorites=t.data})).catch((t=>{console.error("Errore nel recupero dei brani preferiti:",t)}))},openSpotifyTrack(t){t&&t.external_urls&&t.external_urls.spotify?window.open(t.external_urls.spotify,"_blank"):alert("Link Spotify non disponibile per questo brano.")},getArtistNames(t){return t&&0!==t.length?t.map((t=>t.name)).join(", "):"Artista sconosciuto"},getUserStatus(t){const e=this.statuses.find((e=>e.userId==t));return e||{}},setupWebSocket(){const t=new WebSocket("ws://localhost:3000");t.onopen=()=>{console.log("WebSocket connection established.")},t.onmessage=t=>{const e=JSON.parse(t.data);"status_update"===e.type&&(this.statuses=e.data)},t.onclose=()=>{console.log("WebSocket connection closed. Reconnecting in 5s..."),setTimeout((()=>this.setupWebSocket()),5e3)},t.onerror=t=>{console.error("WebSocket error:",t)},this.ws=t}},mounted(){this.getUserData()}};const Rt=(0,u.A)(Ot,[["render",Vt],["__scopeId","data-v-9a4d2d32"]]);var Tt=Rt;const Nt={class:"auth-callback"};function zt(t,e,i,o,a,n){return(0,s.uX)(),(0,s.CE)("div",Nt,e[0]||(e[0]=[(0,s.Lk)("p",null,"Autenticazione in corso...",-1)]))}var Qt={name:"AuthCallback",async mounted(){try{const t=await P.A.get("/auth/me",{withCredentials:!0});if(!t.data)throw new Error("Authentication failed");t.data.isAdmin?this.$router.push("/admin"):this.$router.push("/users")}catch(t){console.error("Authentication error:",t),alert("Authentication failed. Please try again."),this.$router.push("/")}}};const jt=(0,u.A)(Qt,[["render",zt],["__scopeId","data-v-06f37210"]]);var Ht=jt;const Kt={class:"admin-container"},Yt={class:"admin-card"},Zt={class:"header-section"},te={class:"users-cards"},ee={class:"user-card-header"},ie={class:"user-actions"},oe=["onClick"],se=["onClick"],ae={class:"user-card-content"},ne={key:0,class:"modal"},le={class:"modal-content"},re={class:"modal-grid"},ue={class:"input-group"},ce={class:"input-group"},de={class:"input-group"},pe={class:"input-group checkbox-group"},he={class:"modal-buttons"};function ge(t,e,i,a,n,l){return(0,s.uX)(),(0,s.CE)("div",Kt,[(0,s.Lk)("div",Yt,[(0,s.Lk)("div",Zt,[e[8]||(e[8]=(0,s.Lk)("h1",{class:"title"},"Admin Dashboard",-1)),(0,s.Lk)("button",{class:"logout-button",onClick:e[0]||(e[0]=(...t)=>l.logout&&l.logout(...t))},"Logout")]),(0,s.Lk)("div",te,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.users,(t=>((0,s.uX)(),(0,s.CE)("div",{key:t.id,class:"user-card"},[(0,s.Lk)("div",ee,[(0,s.Lk)("strong",null,(0,O.v_)(t.Username),1),(0,s.Lk)("div",ie,[(0,s.Lk)("button",{onClick:e=>l.editUser(t),class:"action-button edit-button"}," Edit ",8,oe),(0,s.Lk)("button",{onClick:e=>l.deleteUser(t.id),class:"action-button delete-button"}," Delete ",8,se)])]),(0,s.Lk)("div",ae,[(0,s.Lk)("p",null,[e[9]||(e[9]=(0,s.Lk)("strong",null,"Email Spotify:",-1)),(0,s.eW)(" "+(0,O.v_)(t.emailSpotify),1)]),(0,s.Lk)("p",null,[e[10]||(e[10]=(0,s.Lk)("strong",null,"Email Twitch:",-1)),(0,s.eW)(" "+(0,O.v_)(t.emailTwitch),1)]),(0,s.Lk)("p",null,[e[11]||(e[11]=(0,s.Lk)("strong",null,"Email Google:",-1)),(0,s.eW)(" "+(0,O.v_)(t.emailGoogle),1)]),(0,s.Lk)("p",null,[e[12]||(e[12]=(0,s.Lk)("strong",null,"Position:",-1)),(0,s.eW)(" "+(0,O.v_)(t.Position),1)]),(0,s.Lk)("p",null,[e[13]||(e[13]=(0,s.Lk)("strong",null,"Date Born:",-1)),(0,s.eW)(" "+(0,O.v_)(l.formatDate(t.DateBorn)),1)]),(0,s.Lk)("p",null,[e[14]||(e[14]=(0,s.Lk)("strong",null,"Admin:",-1)),(0,s.eW)(" "+(0,O.v_)(t.isAdmin?"Yes":"No"),1)])])])))),128))]),n.showModal?((0,s.uX)(),(0,s.CE)("div",ne,[(0,s.Lk)("div",le,[(0,s.Lk)("span",{class:"close",onClick:e[1]||(e[1]=(...t)=>l.closeModal&&l.closeModal(...t))},"×"),e[20]||(e[20]=(0,s.Lk)("h2",null,"Edit User",-1)),(0,s.Lk)("form",{onSubmit:e[7]||(e[7]=(0,o.D$)(((...t)=>l.updateUser&&l.updateUser(...t)),["prevent"]))},[(0,s.Lk)("div",re,[(0,s.Lk)("div",ue,[e[15]||(e[15]=(0,s.Lk)("label",null,"Username:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>n.editingUser.Username=t),type:"text",required:"",class:"cute-input"},null,512),[[o.Jo,n.editingUser.Username]])]),(0,s.Lk)("div",ce,[e[16]||(e[16]=(0,s.Lk)("label",null,"Position:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>n.editingUser.Position=t),type:"text",class:"cute-input"},null,512),[[o.Jo,n.editingUser.Position]])]),(0,s.Lk)("div",de,[e[17]||(e[17]=(0,s.Lk)("label",null,"Date Born:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>n.editingUser.DateBorn=t),type:"date",class:"cute-input"},null,512),[[o.Jo,n.editingUser.DateBorn]])]),(0,s.Lk)("div",pe,[e[18]||(e[18]=(0,s.Lk)("label",null,"Is Admin:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>n.editingUser.isAdmin=t),type:"checkbox"},null,512),[[o.lH,n.editingUser.isAdmin]])])]),(0,s.Lk)("div",he,[e[19]||(e[19]=(0,s.Lk)("button",{type:"submit",class:"save-btn"},"Save",-1)),(0,s.Lk)("button",{type:"button",onClick:e[6]||(e[6]=(...t)=>l.closeModal&&l.closeModal(...t)),class:"cancel-btn"}," Cancel ")])],32)])])):(0,s.Q3)("",!0)])])}var me={name:"AdminPage",data(){return{users:[],showModal:!1,editingUser:{}}},async created(){await this.loadUsers()},methods:{async loadUsers(){try{const t=await P.A.get("/users",{withCredentials:!0});this.users=t.data}catch(t){console.error("Error loading users:",t),alert("Error loading users")}},editUser(t){this.editingUser={...t},this.showModal=!0},closeModal(){this.showModal=!1,this.editingUser={}},async updateUser(){try{await P.A.put(`/users/${this.editingUser.id}`,this.editingUser,{withCredentials:!0,headers:{isadmin:"true",userid:this.editingUser.id}}),await this.loadUsers(),this.closeModal()}catch(t){console.error("Error updating user:",t),alert("Error updating user")}},async deleteUser(t){if(confirm("Are you sure you want to delete this user?"))try{await P.A.delete(`/users/${t}`,{withCredentials:!0,headers:{isadmin:"true",userid:t}}),await this.loadUsers()}catch(e){console.error("Error deleting user:",e),alert("Error deleting user")}},formatDate(t){const e={year:"numeric",month:"long",day:"numeric"};return new Date(t).toLocaleDateString(void 0,e)},async logout(){try{await P.A.post("/logout",{},{withCredentials:!0}),this.$router.push("/")}catch(t){console.error("Logout error:",t),alert("Error during logout.")}}}};const ke=(0,u.A)(me,[["render",ge],["__scopeId","data-v-6ec6a3b6"]]);var fe=ke;const Le=[{path:"/",name:"login",component:V},{path:"/register",name:"register",component:I},{path:"/users",name:"userlist",component:Tt,meta:{requiresAuth:!0}},{path:"/auth/callback",name:"auth-callback",component:Ht},{path:"/:pathMatch(.*)*",redirect:"/"},{path:"/admin",name:"admin",component:fe,meta:{requiresAuth:!0,requiresAdmin:!0}}],be=(0,h.aE)({history:(0,h.LA)("/"),routes:Le});be.beforeEach((async(t,e,i)=>{const o=t.matched.some((t=>t.meta.requiresAuth)),s=t.matched.some((t=>t.meta.requiresAdmin)),a="login"===t.name||"register"===t.name;try{const t=await P.A.get("/auth/check-session",{withCredentials:!0});console.log("Auth check response:",t.data);const e=t.data.authenticated,n=Boolean(t.data.user?.isAdmin);console.log("isAuthenticated:",e,"isAdmin:",n),o&&!e?i({name:"login"}):s&&!n?i({name:"userlist"}):a&&e?i({name:n?"admin":"userlist"}):i()}catch(n){console.error("Auth check error:",n),o?i({name:"login"}):i()}}));var ve=be,ye=i(782),we=(0,ye.y$)({state:{},getters:{},mutations:{},actions:{},modules:{}});(0,o.Ef)(p).use(we).use(ve).mount("#app")}},e={};function i(o){var s=e[o];if(void 0!==s)return s.exports;var a=e[o]={exports:{}};return t[o].call(a.exports,a,a.exports,i),a.exports}i.m=t,function(){var t=[];i.O=function(e,o,s,a){if(!o){var n=1/0;for(c=0;c<t.length;c++){o=t[c][0],s=t[c][1],a=t[c][2];for(var l=!0,r=0;r<o.length;r++)(!1&a||n>=a)&&Object.keys(i.O).every((function(t){return i.O[t](o[r])}))?o.splice(r--,1):(l=!1,a<n&&(n=a));if(l){t.splice(c--,1);var u=s();void 0!==u&&(e=u)}}return e}a=a||0;for(var c=t.length;c>0&&t[c-1][2]>a;c--)t[c]=t[c-1];t[c]=[o,s,a]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){i.p="/"}(),function(){var t={524:0};i.O.j=function(e){return 0===t[e]};var e=function(e,o){var s,a,n=o[0],l=o[1],r=o[2],u=0;if(n.some((function(e){return 0!==t[e]}))){for(s in l)i.o(l,s)&&(i.m[s]=l[s]);if(r)var c=r(i)}for(e&&e(o);u<n.length;u++)a=n[u],i.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return i.O(c)},o=self["webpackChunksite2"]=self["webpackChunksite2"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=i.O(void 0,[504],(function(){return i(680)}));o=i.O(o)})();
//# sourceMappingURL=app.21a92fe5.js.map